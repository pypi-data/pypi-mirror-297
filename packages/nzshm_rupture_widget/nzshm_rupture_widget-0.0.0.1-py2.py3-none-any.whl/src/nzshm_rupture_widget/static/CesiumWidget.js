var T=function(e,c){let p=e.camera.getPickRay(c),n=e.scene.pickFromRay(p);if(n?.object)return n;let i=e.camera.pickEllipsoid(c,e.scene.globe.ellipsoid);if(i)return i.isEllipsoid=!0,{source:"ellipsoid",position:i}};function J(e,c){let a=0,f,t,r,o,s,l,C,I,b,A=!1;e.scene.screenSpaceCameraController.enableCollisionDetection=!1,e.scene.screenSpaceCameraController.enableTranslate=!1,e.scene.screenSpaceCameraController.enableZoom=!1,e.scene.screenSpaceCameraController.enableRotate=!1,e.scene.screenSpaceCameraController.enableTilt=!1,e.scene.screenSpaceCameraController.enableLook=!1,e.scene.pickTranslucentDepth=!0;let Q=function(u){return Cesium.Cartographic.fromCartesian(u.position).height<0},j=function(u){A=!0,t=T(e,u.position)?.position,t&&(a=1,r=Cesium.Cartographic.fromCartesian(t),I=u.position,o=e.scene.camera.position.clone(),s=e.scene.camera.direction.clone(),l=e.scene.camera.up.clone(),C=e.scene.camera.right.clone(),b=new Cesium.Camera(e.scene),b.position=o,b.direction=s,b.up=l,b.right=C)},z=function(u){A=!0,t=T(e,u.position)?.position,t&&(a=3,r=Cesium.Cartographic.fromCartesian(t),I=u.position,o=e.scene.camera.position.clone(),s=e.scene.camera.direction.clone(),l=e.scene.camera.up.clone(),C=e.scene.camera.right.clone())},h=function(u,...d){return d.reduce(function(y,g){return Cesium.Matrix3.multiplyByVector(g,y,new Cesium.Cartesian3)},u)},H=function(u,d,y,g){e.scene.camera.position=u,e.scene.camera.direction=d,e.scene.camera.up=y,e.scene.camera.right=g,c&&c(u,d,y)},B=function(u){let d=Cesium.Math.PI/360*-(I.y-u.endPosition.y),y=Cesium.Math.PI/360*(I.x-u.endPosition.x),g=Cesium.Quaternion.fromAxisAngle(t,y),S=Cesium.Matrix3.fromQuaternion(g),k=h(C,S),x=Cesium.Quaternion.fromAxisAngle(k,-d),E=Cesium.Matrix3.fromQuaternion(x),M=new Cesium.Cartesian3;Cesium.Cartesian3.subtract(o,t,M);let _=h(M,S,E);Cesium.Cartesian3.add(_,t,M);let D=h(s,S,E),L=h(l,S,E),Z=h(C,S,E);H(M,D,L,Z)},U=function(u){let d=b.getPickRay(u.endPosition),y=new Cesium.Plane(Cesium.Cartesian3.normalize(t,new Cesium.Cartesian3),-Cesium.Cartesian3.magnitude(t)),g=Cesium.IntersectionTests.rayPlane(d,y);if(!g)return;let S=Cesium.Cartesian3.angleBetween(g,t),k=Cesium.Cartesian3.cross(g,t,new Cesium.Cartesian3),x=Cesium.Quaternion.fromAxisAngle(k,S),E=Cesium.Matrix3.fromQuaternion(x),M=h(o,E),_=h(s,E),D=h(l,E),L=h(C,E);H(M,_,D,L)},O=function(){t=void 0,a=0},v=function(u){O();let d=T(e,f)?.position;if(d){let y=new Cesium.Cartesian3,g=new Cesium.Cartesian3;Cesium.Cartesian3.subtract(d,e.scene.camera.position,y),Cesium.Cartesian3.normalize(y,g);let S=Cesium.Cartesian3.magnitude(y),x=d.isEllipsoid&&Q(e.scene.camera)?1e3:Math.max(S/4,1e3);u>0?e.scene.camera.move(g,x):e.scene.camera.move(g,-x)}},P=new Cesium.ScreenSpaceEventHandler(e.scene.canvas);P.setInputAction(j,Cesium.ScreenSpaceEventType.LEFT_DOWN),P.setInputAction(z,Cesium.ScreenSpaceEventType.RIGHT_DOWN),P.setInputAction(O,Cesium.ScreenSpaceEventType.RIGHT_UP),P.setInputAction(O,Cesium.ScreenSpaceEventType.LEFT_UP),P.setInputAction(v,Cesium.ScreenSpaceEventType.WHEEL),P.setInputAction(function(u){f=u.endPosition,!(!t||a<0)&&(a==3&&B(u),a==1&&U(u))},Cesium.ScreenSpaceEventType.MOUSE_MOVE),e.scene.canvas.addEventListener("pointerleave",u=>A=!1)}var N=J;var R=function(e,c){if(!c)return;let{extrusion:p,stroke:n,weight:i,fill:m,color:a,opacity:f,fillColor:t,fillOpacity:r}=c;if(e.polygon){let o=e.polygon,s={};if(o.oldStyle=s,p&&(o.extrudedHeight=p),typeof n<"u"&&(s.outline=o.outline,o.outline=n),i&&(s.outlineWidth=o.outlineWidth,o.outlineWidth=i),typeof m<"u"&&(s.fill=m,o.fill=m),a&&(s.outlineColor=o.outlineColor,o.outlineColor=a),f){s.outlineColor=o.outlineColor;let l=Cesium.Color.fromCssColorString(o.outlineColor),C=typeof f=="string"?parseFloat(f):f;o.outlineColor=l.withAlpha(C)}if(t){s.material=o.material;let l=Cesium.Color.fromCssColorString(t);if(r){let C=typeof r=="string"?parseFloat(r):r;l=l.withAlpha(C)}o.material=new Cesium.ColorMaterialProperty(l)}}typeof n<"u"&&e.polyline&&(e.polyline.show=n)},F=function(e){if(e&&e.polygon?.oldStyle){for(let c in e.polygon.oldStyle)e.polygon[c]=e.polygon.oldStyle[c];e.polygon.oldStyle=void 0}};function q(e,c,p){let n=new Cesium.ScreenSpaceEventHandler(e.scene.canvas),i,m=function(a,f){if(a){if(a?.source==="ellipsoid")return a;if(a?.object?.id instanceof Cesium.Entity){let t=a.object.id;if(i==t)return;c&&R(t,c),F(i),i=t;let r=t.properties,o=r.propertyNames.reduce((s,l)=>(s[l]=r[l].getValue(),s),{});return{source:"entity",entity:t,properties:o,windowPosition:f,position:a.position}}}};n.setInputAction(function(a){let f=T(e,a.endPosition),t=m(f,a.endPosition);t&&p(t)},Cesium.ScreenSpaceEventType.MOUSE_MOVE)}var w=q;function V(e,c){if(typeof e[0]=="number")e[2]&&(e[2]=e[2]*c);else for(let p of e)V(p,c)}function W(e){if(typeof e[0]=="number")e[2]&&e.pop();else for(let c of e)W(c)}function K(e){let c=e.elevationToMeters||-1e3;for(let n of e.features){n.properties?.style?.extrusion?W(n.geometry.coordinates):c!==1&&V(n.geometry.coordinates,c);let m=n.properties.style;if(m){let a=[["color","stroke"],["weight","stroke-width"],["opacity","stroke-opacity"],["fillColor","fill"],["fillOpacity","fill-opacity"]];for(let[f,t]of a)m[f]&&(n.properties[t]=m[f])}}let p=Cesium.GeoJsonDataSource.load(e);return p.then(function(n){for(let i of n.entities.values){let m=i.properties.getValue().style,a=m?.extrusion;a&&(i.polygon.extrudedHeight=a);let f=m?.stroke;typeof f<"u"&&(i.polygon&&(i.polygon.outline=f),i.polyline&&(i.polyline.show=f));let t=m?.weight;t&&i.polygon&&(i.polygon.outlineWidth=t);let r=m?.fill;typeof r<"u"&&i.polygon&&(i.polygon.fill=r)}}),p}var G=K;function X(e){return new Promise((c,p)=>{let n=Object.assign(document.createElement("script"),{type:"text/javascript",async:!0,src:e});n.addEventListener("load",c),n.addEventListener("error",p),document.body.appendChild(n)})}await X("https://cesium.com/downloads/cesiumjs/releases/1.121/Build/Cesium/Cesium.js");function Y({model:e,el:c}){let p=document.createElement("div");p.id="cesiumContainer",p.style.width="100%",p.style.height="100%";let n=new Cesium.Viewer(p,{animation:!1,baseLayerPicker:!1,navigationHelpButton:!1,navigationInstructionsInitiallyVisible:!1,sceneModePicker:!1,homeButton:!1,geocoder:!1,fullscreenButton:!1,timeline:!1,baseLayer:new Cesium.ImageryLayer(new Cesium.OpenStreetMapImageryProvider({url:"https://tile.openstreetmap.org/",credit:new Cesium.Credit("Cesium: OpenStreetMap",!0)})),depthPlaneEllipsoidOffset:-1e5}),i=e.get("_camera");i&&Object.keys(i).length>0?n.camera.setView({destination:i.position,orientation:{direction:i.direction,up:i.up}}):n.camera.setView({destination:Cesium.Cartesian3.fromDegrees(175.57716369628906,-41.35120773,95e3)}),n.scene.mode=Cesium.SceneMode.SCENE3D,n.scene.globe.translucency.enabled=!0,n.scene.globe.translucency.frontFaceAlpha=e.get("globe_opacity"),n.scene.globe.undergroundColor=Cesium.Color.WHITE,n.selectedEntityChanged.addEventListener(function(o){o&&e.get("no_info")&&(n.selectedEntity=void 0)}),N(n,function(o,s,l){e.set("_camera",{position:o,direction:s,up:l}),e.save_changes()});let a=e.get("hover_style");w(n,a,o=>{let{source:s,properties:l,windowPosition:C}=o;s!=="ellipsoid"&&e.send({msg:"pick",source:s,properties:l,windowPosition:C})});let f=e.get("data"),t=e.get("selection")||0,r=[];for(let o of f){let s=G(o),l=t===-1||r.length==t;s.then(function(C){C.show=l}),r.push(s),n.dataSources.add(s)}if(n.zoomTo(r[t]),r.length>1&&t>-1){let o=function(s){s!==t&&(r[t].then(function(l){l.show=!1}),t=s,r[t].then(function(l){l.show=!0}),n.zoomTo(r[t])),e.get("selection")!==t&&(e.set("selection",t),e.save_changes())};e.on("change:selection",function(){o(e.get("selection"))})}return e.on("change:globe_opacity",function(){n.scene.globe.translucency.frontFaceAlpha=e.get("globe_opacity")}),e.on("msg:custom",function(o){o?.action==="home"&&n.zoomTo(r[t])}),p.addEventListener("contextmenu",function(o){o.stopPropagation()}),c.appendChild(p),function(){for(console.log("destroy CesiumWidget");r.length;)r.pop();n.entities.removeAll(),n.destroy()}}var re={render:Y};export{re as default};
