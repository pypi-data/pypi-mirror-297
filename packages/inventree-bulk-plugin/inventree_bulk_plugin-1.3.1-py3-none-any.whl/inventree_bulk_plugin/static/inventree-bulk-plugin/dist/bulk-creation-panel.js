var be,N,Qe,Y,Be,Xe,we,Se,xe,Te,Ze,ne={},et=[],bt=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,Pe=Array.isArray;function z(e,t){for(var n in t)e[n]=t[n];return e}function tt(e){var t=e.parentNode;t&&t.removeChild(e)}function gt(e,t,n){var r,s,a,i={};for(a in t)a=="key"?r=t[a]:a=="ref"?s=t[a]:i[a]=t[a];if(arguments.length>2&&(i.children=arguments.length>3?be.call(arguments,2):n),typeof e=="function"&&e.defaultProps!=null)for(a in e.defaultProps)i[a]===void 0&&(i[a]=e.defaultProps[a]);return de(e,i,r,s,null)}function de(e,t,n,r,s){var a={type:e,props:t,key:n,ref:r,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:s??++Qe,__i:-1,__u:0};return s==null&&N.vnode!=null&&N.vnode(a),a}function vt(){return{current:null}}function H(e){return e.children}function _e(e,t){this.props=e,this.context=t}function Q(e,t){if(t==null)return e.__?Q(e.__,e.__i+1):null;for(var n;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null)return n.__e;return typeof e.type=="function"?Q(e):null}function nt(e){var t,n;if((e=e.__)!=null&&e.__c!=null){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null){e.__e=e.__c.base=n.__e;break}return nt(e)}}function Ce(e){(!e.__d&&(e.__d=!0)&&Y.push(e)&&!me.__r++||Be!==N.debounceRendering)&&((Be=N.debounceRendering)||Xe)(me)}function me(){var e,t,n,r,s,a,i,u;for(Y.sort(we);e=Y.shift();)e.__d&&(t=Y.length,r=void 0,a=(s=(n=e).__v).__e,i=[],u=[],n.__P&&((r=z({},s)).__v=s.__v+1,N.vnode&&N.vnode(r),Ae(n.__P,r,s,n.__n,n.__P.ownerSVGElement!==void 0,32&s.__u?[a]:null,i,a??Q(s),!!(32&s.__u),u),r.__v=s.__v,r.__.__k[r.__i]=r,ot(i,r,u),r.__e!=a&&nt(r)),Y.length>t&&Y.sort(we));me.__r=0}function rt(e,t,n,r,s,a,i,u,d,o,b){var c,f,m,y,h,v=r&&r.__k||et,k=t.length;for(n.__d=d,$t(n,t,v),d=n.__d,c=0;c<k;c++)(m=n.__k[c])!=null&&typeof m!="boolean"&&typeof m!="function"&&(f=m.__i===-1?ne:v[m.__i]||ne,m.__i=c,Ae(e,m,f,s,a,i,u,d,o,b),y=m.__e,m.ref&&f.ref!=m.ref&&(f.ref&&Le(f.ref,null,m),b.push(m.ref,m.__c||y,m)),h==null&&y!=null&&(h=y),65536&m.__u||f.__k===m.__k?(d&&!d.isConnected&&(d=Q(f)),d=lt(m,d,e)):typeof m.type=="function"&&m.__d!==void 0?d=m.__d:y&&(d=y.nextSibling),m.__d=void 0,m.__u&=-196609);n.__d=d,n.__e=h}function $t(e,t,n){var r,s,a,i,u,d=t.length,o=n.length,b=o,c=0;for(e.__k=[],r=0;r<d;r++)i=r+c,(s=e.__k[r]=(s=t[r])==null||typeof s=="boolean"||typeof s=="function"?null:typeof s=="string"||typeof s=="number"||typeof s=="bigint"||s.constructor==String?de(null,s,null,null,null):Pe(s)?de(H,{children:s},null,null,null):s.constructor===void 0&&s.__b>0?de(s.type,s.props,s.key,s.ref?s.ref:null,s.__v):s)!=null?(s.__=e,s.__b=e.__b+1,u=kt(s,n,i,b),s.__i=u,a=null,u!==-1&&(b--,(a=n[u])&&(a.__u|=131072)),a==null||a.__v===null?(u==-1&&c--,typeof s.type!="function"&&(s.__u|=65536)):u!==i&&(u===i+1?c++:u>i?b>d-i?c+=u-i:c--:u<i?u==i-1&&(c=u-i):c=0,u!==r+c&&(s.__u|=65536))):(a=n[i])&&a.key==null&&a.__e&&!(131072&a.__u)&&(a.__e==e.__d&&(e.__d=Q(a)),Ee(a,a,!1),n[i]=null,b--);if(b)for(r=0;r<o;r++)(a=n[r])!=null&&!(131072&a.__u)&&(a.__e==e.__d&&(e.__d=Q(a)),Ee(a,a))}function lt(e,t,n){var r,s;if(typeof e.type=="function"){for(r=e.__k,s=0;r&&s<r.length;s++)r[s]&&(r[s].__=e,t=lt(r[s],t,n));return t}e.__e!=t&&(n.insertBefore(e.__e,t||null),t=e.__e);do t=t&&t.nextSibling;while(t!=null&&t.nodeType===8);return t}function kt(e,t,n,r){var s=e.key,a=e.type,i=n-1,u=n+1,d=t[n];if(d===null||d&&s==d.key&&a===d.type&&!(131072&d.__u))return n;if(r>(d!=null&&!(131072&d.__u)?1:0))for(;i>=0||u<t.length;){if(i>=0){if((d=t[i])&&!(131072&d.__u)&&s==d.key&&a===d.type)return i;i--}if(u<t.length){if((d=t[u])&&!(131072&d.__u)&&s==d.key&&a===d.type)return u;u++}}return-1}function Ge(e,t,n){t[0]==="-"?e.setProperty(t,n??""):e[t]=n==null?"":typeof n!="number"||bt.test(t)?n:n+"px"}function ue(e,t,n,r,s){var a;e:if(t==="style")if(typeof n=="string")e.style.cssText=n;else{if(typeof r=="string"&&(e.style.cssText=r=""),r)for(t in r)n&&t in n||Ge(e.style,t,"");if(n)for(t in n)r&&n[t]===r[t]||Ge(e.style,t,n[t])}else if(t[0]==="o"&&t[1]==="n")a=t!==(t=t.replace(/(PointerCapture)$|Capture$/i,"$1")),t=t.toLowerCase()in e||t==="onFocusOut"||t==="onFocusIn"?t.toLowerCase().slice(2):t.slice(2),e.l||(e.l={}),e.l[t+a]=n,n?r?n.u=r.u:(n.u=Se,e.addEventListener(t,a?Te:xe,a)):e.removeEventListener(t,a?Te:xe,a);else{if(s)t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(t!="width"&&t!="height"&&t!="href"&&t!="list"&&t!="form"&&t!="tabIndex"&&t!="download"&&t!="rowSpan"&&t!="colSpan"&&t!="role"&&t in e)try{e[t]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&t[4]!=="-"?e.removeAttribute(t):e.setAttribute(t,n))}}function Ve(e){return function(t){if(this.l){var n=this.l[t.type+e];if(t.t==null)t.t=Se++;else if(t.t<n.u)return;return n(N.event?N.event(t):t)}}}function Ae(e,t,n,r,s,a,i,u,d,o){var b,c,f,m,y,h,v,k,_,p,g,x,L,E,V,j=t.type;if(t.constructor!==void 0)return null;128&n.__u&&(d=!!(32&n.__u),a=[u=t.__e=n.__e]),(b=N.__b)&&b(t);e:if(typeof j=="function")try{if(k=t.props,_=(b=j.contextType)&&r[b.__c],p=b?_?_.props.value:b.__:r,n.__c?v=(c=t.__c=n.__c).__=c.__E:("prototype"in j&&j.prototype.render?t.__c=c=new j(k,p):(t.__c=c=new _e(k,p),c.constructor=j,c.render=xt),_&&_.sub(c),c.props=k,c.state||(c.state={}),c.context=p,c.__n=r,f=c.__d=!0,c.__h=[],c._sb=[]),c.__s==null&&(c.__s=c.state),j.getDerivedStateFromProps!=null&&(c.__s==c.state&&(c.__s=z({},c.__s)),z(c.__s,j.getDerivedStateFromProps(k,c.__s))),m=c.props,y=c.state,c.__v=t,f)j.getDerivedStateFromProps==null&&c.componentWillMount!=null&&c.componentWillMount(),c.componentDidMount!=null&&c.__h.push(c.componentDidMount);else{if(j.getDerivedStateFromProps==null&&k!==m&&c.componentWillReceiveProps!=null&&c.componentWillReceiveProps(k,p),!c.__e&&(c.shouldComponentUpdate!=null&&c.shouldComponentUpdate(k,c.__s,p)===!1||t.__v===n.__v)){for(t.__v!==n.__v&&(c.props=k,c.state=c.__s,c.__d=!1),t.__e=n.__e,t.__k=n.__k,t.__k.forEach(function(B){B&&(B.__=t)}),g=0;g<c._sb.length;g++)c.__h.push(c._sb[g]);c._sb=[],c.__h.length&&i.push(c);break e}c.componentWillUpdate!=null&&c.componentWillUpdate(k,c.__s,p),c.componentDidUpdate!=null&&c.__h.push(function(){c.componentDidUpdate(m,y,h)})}if(c.context=p,c.props=k,c.__P=e,c.__e=!1,x=N.__r,L=0,"prototype"in j&&j.prototype.render){for(c.state=c.__s,c.__d=!1,x&&x(t),b=c.render(c.props,c.state,c.context),E=0;E<c._sb.length;E++)c.__h.push(c._sb[E]);c._sb=[]}else do c.__d=!1,x&&x(t),b=c.render(c.props,c.state,c.context),c.state=c.__s;while(c.__d&&++L<25);c.state=c.__s,c.getChildContext!=null&&(r=z(z({},r),c.getChildContext())),f||c.getSnapshotBeforeUpdate==null||(h=c.getSnapshotBeforeUpdate(m,y)),rt(e,Pe(V=b!=null&&b.type===H&&b.key==null?b.props.children:b)?V:[V],t,n,r,s,a,i,u,d,o),c.base=t.__e,t.__u&=-161,c.__h.length&&i.push(c),v&&(c.__E=c.__=null)}catch(B){t.__v=null,d||a!=null?(t.__e=u,t.__u|=d?160:32,a[a.indexOf(u)]=null):(t.__e=n.__e,t.__k=n.__k),N.__e(B,t,n)}else a==null&&t.__v===n.__v?(t.__k=n.__k,t.__e=n.__e):t.__e=wt(n.__e,t,n,r,s,a,i,d,o);(b=N.diffed)&&b(t)}function ot(e,t,n){t.__d=void 0;for(var r=0;r<n.length;r++)Le(n[r],n[++r],n[++r]);N.__c&&N.__c(t,e),e.some(function(s){try{e=s.__h,s.__h=[],e.some(function(a){a.call(s)})}catch(a){N.__e(a,s.__v)}})}function wt(e,t,n,r,s,a,i,u,d){var o,b,c,f,m,y,h,v=n.props,k=t.props,_=t.type;if(_==="svg"&&(s=!0),a!=null){for(o=0;o<a.length;o++)if((m=a[o])&&"setAttribute"in m==!!_&&(_?m.localName===_:m.nodeType===3)){e=m,a[o]=null;break}}if(e==null){if(_===null)return document.createTextNode(k);e=s?document.createElementNS("http://www.w3.org/2000/svg",_):document.createElement(_,k.is&&k),a=null,u=!1}if(_===null)v===k||u&&e.data===k||(e.data=k);else{if(a=a&&be.call(e.childNodes),v=n.props||ne,!u&&a!=null)for(v={},o=0;o<e.attributes.length;o++)v[(m=e.attributes[o]).name]=m.value;for(o in v)m=v[o],o=="children"||(o=="dangerouslySetInnerHTML"?c=m:o==="key"||o in k||ue(e,o,null,m,s));for(o in k)m=k[o],o=="children"?f=m:o=="dangerouslySetInnerHTML"?b=m:o=="value"?y=m:o=="checked"?h=m:o==="key"||u&&typeof m!="function"||v[o]===m||ue(e,o,m,v[o],s);if(b)u||c&&(b.__html===c.__html||b.__html===e.innerHTML)||(e.innerHTML=b.__html),t.__k=[];else if(c&&(e.innerHTML=""),rt(e,Pe(f)?f:[f],t,n,r,s&&_!=="foreignObject",a,i,a?a[0]:n.__k&&Q(n,0),u,d),a!=null)for(o=a.length;o--;)a[o]!=null&&tt(a[o]);u||(o="value",y!==void 0&&(y!==e[o]||_==="progress"&&!y||_==="option"&&y!==v[o])&&ue(e,o,y,v[o],!1),o="checked",h!==void 0&&h!==e[o]&&ue(e,o,h,v[o],!1))}return e}function Le(e,t,n){try{typeof e=="function"?e(t):e.current=t}catch(r){N.__e(r,n)}}function Ee(e,t,n){var r,s;if(N.unmount&&N.unmount(e),(r=e.ref)&&(r.current&&r.current!==e.__e||Le(r,null,t)),(r=e.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(a){N.__e(a,t)}r.base=r.__P=null}if(r=e.__k)for(s=0;s<r.length;s++)r[s]&&Ee(r[s],t,n||typeof e.type!="function");n||e.__e==null||tt(e.__e),e.__c=e.__=e.__e=e.__d=void 0}function xt(e,t,n){return this.constructor(e,n)}function Tt(e,t,n){var r,s,a,i;N.__&&N.__(e,t),s=(r=typeof n=="function")?null:t.__k,a=[],i=[],Ae(t,e=(!r&&n||t).__k=gt(H,null,[e]),s||ne,ne,t.ownerSVGElement!==void 0,!r&&n?[n]:s?null:t.firstChild?be.call(t.childNodes):null,a,!r&&n?n:s?s.__e:t.firstChild,r,i),ot(a,e,i)}function st(e,t){var n={__c:t="__cC"+Ze++,__:e,Consumer:function(r,s){return r.children(s)},Provider:function(r){var s,a;return this.getChildContext||(s=[],(a={})[t]=this,this.getChildContext=function(){return a},this.shouldComponentUpdate=function(i){this.props.value!==i.value&&s.some(function(u){u.__e=!0,Ce(u)})},this.sub=function(i){s.push(i);var u=i.componentWillUnmount;i.componentWillUnmount=function(){s.splice(s.indexOf(i),1),u&&u.call(i)}}),r.children}};return n.Provider.__=n.Consumer.contextType=n}be=et.slice,N={__e:function(e,t,n,r){for(var s,a,i;t=t.__;)if((s=t.__c)&&!s.__)try{if((a=s.constructor)&&a.getDerivedStateFromError!=null&&(s.setState(a.getDerivedStateFromError(e)),i=s.__d),s.componentDidCatch!=null&&(s.componentDidCatch(e,r||{}),i=s.__d),i)return s.__E=s}catch(u){e=u}throw e}},Qe=0,_e.prototype.setState=function(e,t){var n;n=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=z({},this.state),typeof e=="function"&&(e=e(z({},n),this.props)),e&&z(n,e),e!=null&&this.__v&&(t&&this._sb.push(t),Ce(this))},_e.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),Ce(this))},_e.prototype.render=H,Y=[],Xe=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,we=function(e,t){return e.__v.__b-t.__v.__b},me.__r=0,Se=0,xe=Ve(!1),Te=Ve(!0),Ze=0;var X,I,$e,He,re=0,at=[],pe=[],P=N,Me=P.__b,Re=P.__r,We=P.diffed,Ke=P.__c,Je=P.unmount,qe=P.__;function le(e,t){P.__h&&P.__h(I,e,re||t),re=0;var n=I.__H||(I.__H={__:[],__h:[]});return e>=n.__.length&&n.__.push({__V:pe}),n.__[e]}function O(e){return re=1,Ct(ut,e)}function Ct(e,t,n){var r=le(X++,2);if(r.t=e,!r.__c&&(r.__=[ut(void 0,t),function(u){var d=r.__N?r.__N[0]:r.__[0],o=r.t(d,u);d!==o&&(r.__N=[o,r.__[1]],r.__c.setState({}))}],r.__c=I,!I.u)){var s=function(u,d,o){if(!r.__c.__H)return!0;var b=r.__c.__H.__.filter(function(f){return!!f.__c});if(b.every(function(f){return!f.__N}))return!a||a.call(this,u,d,o);var c=!1;return b.forEach(function(f){if(f.__N){var m=f.__[0];f.__=f.__N,f.__N=void 0,m!==f.__[0]&&(c=!0)}}),!(!c&&r.__c.props===u)&&(!a||a.call(this,u,d,o))};I.u=!0;var a=I.shouldComponentUpdate,i=I.componentWillUpdate;I.componentWillUpdate=function(u,d,o){if(this.__e){var b=a;a=void 0,s(u,d,o),a=b}i&&i.call(this,u,d,o)},I.shouldComponentUpdate=s}return r.__N||r.__}function A(e,t){var n=le(X++,3);!P.__s&&ct(n.__H,t)&&(n.__=e,n.i=t,I.__H.__h.push(n))}function D(e){return re=5,J(function(){return{current:e}},[])}function J(e,t){var n=le(X++,7);return ct(n.__H,t)?(n.__V=e(),n.i=t,n.__h=e,n.__V):n.__}function w(e,t){return re=8,J(function(){return e},t)}function it(e){var t=I.context[e.__c],n=le(X++,9);return n.c=e,t?(n.__==null&&(n.__=!0,t.sub(I)),t.props.value):e.__}function ee(){var e=le(X++,11);if(!e.__){for(var t=I.__v;t!==null&&!t.__m&&t.__!==null;)t=t.__;var n=t.__m||(t.__m=[0,0]);e.__="P"+n[0]+"-"+n[1]++}return e.__}function Et(){for(var e;e=at.shift();)if(e.__P&&e.__H)try{e.__H.__h.forEach(fe),e.__H.__h.forEach(Oe),e.__H.__h=[]}catch(t){e.__H.__h=[],P.__e(t,e.__v)}}P.__b=function(e){I=null,Me&&Me(e)},P.__=function(e,t){e&&t.__k&&t.__k.__m&&(e.__m=t.__k.__m),qe&&qe(e,t)},P.__r=function(e){Re&&Re(e),X=0;var t=(I=e.__c).__H;t&&($e===I?(t.__h=[],I.__h=[],t.__.forEach(function(n){n.__N&&(n.__=n.__N),n.__V=pe,n.__N=n.i=void 0})):(t.__h.forEach(fe),t.__h.forEach(Oe),t.__h=[],X=0)),$e=I},P.diffed=function(e){We&&We(e);var t=e.__c;t&&t.__H&&(t.__H.__h.length&&(at.push(t)!==1&&He===P.requestAnimationFrame||((He=P.requestAnimationFrame)||Ot)(Et)),t.__H.__.forEach(function(n){n.i&&(n.__H=n.i),n.__V!==pe&&(n.__=n.__V),n.i=void 0,n.__V=pe})),$e=I=null},P.__c=function(e,t){t.some(function(n){try{n.__h.forEach(fe),n.__h=n.__h.filter(function(r){return!r.__||Oe(r)})}catch(r){t.some(function(s){s.__h&&(s.__h=[])}),t=[],P.__e(r,n.__v)}}),Ke&&Ke(e,t)},P.unmount=function(e){Je&&Je(e);var t,n=e.__c;n&&n.__H&&(n.__H.__.forEach(function(r){try{fe(r)}catch(s){t=s}}),n.__H=void 0,t&&P.__e(t,n.__v))};var ze=typeof requestAnimationFrame=="function";function Ot(e){var t,n=function(){clearTimeout(r),ze&&cancelAnimationFrame(t),setTimeout(e)},r=setTimeout(n,100);ze&&(t=requestAnimationFrame(n))}function fe(e){var t=I,n=e.__c;typeof n=="function"&&(e.__c=void 0,n()),I=t}function Oe(e){var t=I;e.__c=e.__(),I=t}function ct(e,t){return!e||e.length!==t.length||t.some(function(n,r){return n!==e[r]})}function ut(e,t){return typeof t=="function"?t(e):t}var jt=0;function l(e,t,n,r,s,a){var i,u,d={};for(u in t)u=="ref"?i=t[u]:d[u]=t[u];var o={type:e,props:d,key:n,ref:i,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:--jt,__i:-1,__u:0,__source:s,__self:a};if(typeof e=="function"&&(i=e.defaultProps))for(u in i)d[u]===void 0&&(d[u]=i[u]);return N.vnode&&N.vnode(o),o}const te=({title:e,children:t,show:n,scrollable:r,onClose:s,actions:a=[],size:i})=>{const u=D(null),d=D(null);return A(()=>{d.current=bootstrap.Modal.getOrCreateInstance(u.current,{backdrop:"static"})},[]),A(()=>{n?d.current.show():d.current.hide()},[n]),A(()=>{const o=u==null?void 0:u.current;if(!o)return;const b=()=>s==null?void 0:s();return o.addEventListener("hidden.bs.modal",b),()=>o.removeEventListener("hidden.bs.modal",b)},[s]),A(()=>()=>d.current.hide(),[]),l("div",{class:`modal fade ${i?`modal-${i}`:""}`,tabIndex:-1,ref:u,children:l("div",{class:`modal-dialog ${r?"modal-dialog-scrollable":""}`,children:l("div",{class:"modal-content",style:`${r?"":"max-height: 92vh;"}`,children:[l("div",{class:"modal-header",children:[l("h5",{class:"modal-title",children:e}),l("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})]}),l("div",{class:"modal-body",children:t}),l("div",{class:"modal-footer",children:[s&&l("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal",children:"Close"}),a.map(({label:o,type:b,onClick:c,disabled:f=!1,loading:m})=>l("button",{type:"button",class:`btn btn-${b}`,onClick:c,disabled:f,children:[m&&l("span",{class:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),o]}))]})]})})})};function Z({text:e,children:t,placement:n="auto"}){const r=ee();return A(()=>{const s=document.getElementById(r);if(!s)return;const a=bootstrap.Tooltip.getOrCreateInstance(s,{placement:n});return()=>{a.dispose()}},[r,n]),e?l("div",{id:r,class:"preact-tooltip","data-bs-title":e,"data-bs-toggle":"tooltip",children:t}):l(H,{children:t})}const G={"_part.part_image":{render:e=>{if(!e.pk&&!e.id)return"";e.image||(e.image=e.pk||e.id);let t="";return e.image?t=/^(?:[a-z+]+:)?\/\//.test(e.image)?e.image:`/media/${e.image}`:t=blankImage(),renderModel({image:t,text:e.image||`Not found: ${e.id}`})},mapFunction:e=>({...e,id:e.image||e.id}),getSingle:(e,t)=>{inventreeGet("/api/part/thumbs/",{},{success:n=>{t(n.find(r=>r.image===e)||{image:"",id:e})}})}}};function R(e){const t=ee(),n=l(H,{children:[e.extraButtons,e.onDelete&&l("button",{class:"btn btn-outline-danger btn-sm",onClick:e.onDelete,children:l("i",{class:"fa fa-trash"})})]});return l("div",{class:"form-group row",children:[l("div",{class:"col-sm-2",children:l(Z,{text:e.tooltip,children:l("label",{for:`input-${t}`,class:"col-form-label col-form-label-sm",children:e.label})})}),(()=>{if(e.type==="text"||e.type==="number"||e.type==="email"||e.type==="float"){const{type:r,...s}=e;return l("div",{class:"col-sm-10 input-group",style:"flex: 1;",children:[l("input",{type:r==="float"?"number":r,class:"form-control form-control-sm",id:`input-${t}`,...r==="float"?{step:"any"}:{},...s}),n]})}else{if(e.type==="model")return l(Nt,{extraFormGroup:n,id:t,...e});if(e.type==="checkbox"||e.type==="boolean"){const{type:r,value:s,...a}=e;return l("div",{class:"col-sm-10 input-group",style:"flex: 1;",children:[l("label",{class:"input-group-text",style:"flex: 1;",for:`input-${t}`,children:l("input",{type:"checkbox",class:"form-check-input form-check-sm",id:`input-${t}`,checked:s,...a,onInput:i=>{var u;return(u=a.onInput)==null?void 0:u.call(a,{currentTarget:{value:i.currentTarget.checked}})}})}),n]})}else{if(e.type==="textarea")return l("div",{class:"col-sm-10 input-group",style:"flex: 1;",children:[l("textarea",{class:"form-control form-control-sm",id:`input-${t}`,...e}),n]});if(e.type==="select")return l("div",{class:"col-sm-10 input-group",style:"flex: 1;",children:[l("select",{class:"form-select form-select-sm",id:`input-${t}`,...e,children:Object.entries(e.options).map(([r,s])=>l("option",{value:r,children:s}))}),n]});if(e.type==="array"){const{onDelete:r,onAdd:s}=e,a=i=>!e.onAdd&&e.value.length===i+1;return l("div",{class:"col-sm-10",children:l("div",{class:"d-flex flex-row flex-nowrap",style:"gap: 4px",children:[e.value.map((i,u)=>l("div",{class:"input-group",style:`max-width: 350px; ${a(u)?"margin-right: 31px;":""}`,children:[l("input",{type:"text",class:"form-control form-control-sm",id:`input-${t}-${u}`,value:i,onInput:d=>e.onInput(u)(()=>d.currentTarget.value)}),r&&l("button",{class:"btn btn-outline-danger btn-sm",onClick:r(u),children:l("i",{class:"fa fa-trash"})})]})),s&&l("button",{class:"btn btn-outline-primary btn-sm",onClick:()=>s(),children:"+"})]})})}}}return"Not implemented"})()]})}const Nt=({model:e,extraFormGroup:t,id:n,onInput:r,value:s})=>(A(()=>($(`#${n}`).select2({placeholder:"",allowClear:!0,ajax:{url:e.api_url,dataType:"json",delay:250,cache:!0,data:a=>{var i;return{search:(i=a.term)==null?void 0:i.trim(),offset:a.page?(a.page-1)*25:0,limit:25,...e.limit_choices_to}},processResults:a=>{let i=[],u=!1;"count"in a&&"results"in a?(i=a.results,a.next&&(u=!0)):i=a;let d=i.map(o=>({id:o.pk,...o}));return G[e.model]&&(d=d.map(G[e.model].mapFunction)),{results:d,pagination:{more:u}}}},templateResult:a=>{var d;let i=a;if((d=a.element)!=null&&d.instance&&(i=a.element.instance),G[e.model])return $(G[e.model].render(i));if(!i.pk)return $("<span>Searching...</span>");const u=e.model.toLowerCase().split(".").at(-1);return $(`${renderModelData("",u,i,{})} <span>(${i.pk})</span>`)},templateSelection:a=>{var d;let i=a;if((d=a.element)!=null&&d.instance&&(i=a.element.instance),G[e.model])return $(G[e.model].render(i));if(!i.pk)return"";const u=e.model.toLowerCase().split(".").at(-1);return $(`${renderModelData("",u,i,{})} <span>(${i.pk})</span>`)}}),()=>{$(`#${n}`).select2("destroy")}),[n,e.api_url,e.limit_choices_to,e.model]),A(()=>($(`#${n}`).on("select2:select",a=>{r==null||r(a)}),$(`#${n}`).on("select2:clear",()=>{r==null||r({currentTarget:{value:""}})}),()=>{$(`#${n}`).off("select2:select"),$(`#${n}`).off("select2:clear")}),[n,r]),A(()=>{if(s&&s!==$(`#${n}`).val()){const a=`${e.api_url}/${s}/`.replace("//","/"),i=d=>{G[e.model]&&(d=G[e.model].mapFunction(d));const o=new Option("",d.id??d.pk,!0,!0);o.instance=d,$(`#${n}`).append(o).trigger("change"),$(`#${n}`).trigger({type:"select2:select",params:{data:d}})},u=G[e.model];if(u!=null&&u.getSingle)return u.getSingle(s,i);inventreeGet(a,{...e.limit_choices_to},{success:i})}},[n,e.api_url,e.limit_choices_to,e.model,s]),l("div",{class:"col-sm-10 input-group",style:"flex: 1;",children:[l("select",{class:"form-select form-select-sm",id:n}),t]})),dt=st({showNotification:()=>1}),oe=()=>{const{showNotification:e}=it(dt);return{showNotification:e}},It=({children:e})=>{const[t,n]=O([]),r=D([]);r.current=t.map((a,i)=>r.current[i]??vt());const s=w(a=>{const i=Math.random().toString(36).substring(2),u={id:i,autoHide:!0,...a};n(d=>[...d,u]),setTimeout(()=>{const d=r.current.length-1,o=r.current[d].current;bootstrap.Toast.getOrCreateInstance(o,{autohide:u.autoHide}).show(),o.addEventListener("hidden.bs.toast",()=>{n(c=>c.filter(f=>f.id!==i))})},0)},[]);return l(dt.Provider,{value:{showNotification:s},children:l("div",{children:[e,l("div",{style:"position: fixed; bottom: 6px; right: 6px; display: flex; flex-direction: column; gap: 6px; z-index: 999999;",children:t.map(({id:a,type:i,message:u},d)=>l("div",{role:"alert","aria-live":"assertive","aria-atomic":"true",class:"toast",style:"border-radius: 5px;",ref:r.current[d],children:l("div",{class:`alert alert-${i}`,style:"margin-bottom: 0; padding: 8px; opacity: 0.8;",children:l("div",{style:{display:"flex",justifyContent:"space-between"},children:[l("div",{children:u}),l("button",{type:"button",class:"btn-close","data-bs-dismiss":"toast","aria-label":"Close",style:{fontSize:"10px"}})]})})},a))})]})})},je=(e,t)=>{if(e===t)return!0;if(e===null&&t!==null||e!==null&&t===null||typeof e!=typeof t)return!1;if(Array.isArray(e)&&Array.isArray(t))return e.length!==t.length?!1:e.every((n,r)=>je(e[r],t[r]));if(e instanceof Date&&t instanceof Date)return e.getTime()===t.getTime();if(typeof e=="object"){const n=Object.keys(e),r=Object.keys(t);return n.length!==r.length?!1:n.every(s=>je(e[s],t[s]))}return!1},Ne=e=>{var n;const t={...e};return t.parent_name_match===""&&delete t.parent_name_match,t.extends===""&&delete t.extends,t.count=e.count.map(r=>r||null),t.childs=(n=e.childs)==null?void 0:n.map(Ne),t},he=e=>({...e,templates:e.templates.map(Ne),output:Ne(e.output)}),St=e=>{const t=new Set,n=r=>{var s;for(const a of Object.keys(r.generate))t.add(a);(s=r.childs)==null||s.forEach(a=>n(a))};return n(e.output),e.templates.forEach(r=>n(r)),[...t]};function Pt(e=1){return()=>e++}const _t=(e,t,n=0,r="...")=>e.flatMap(([s,a])=>{const i=t(),u=`${r}/${s.name}`;return[{...s,id:i,pid:n,path:u},..._t(a,t,i,u)]}),ke=e=>e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),At=(e,t)=>{const n=document.createElement("a");n.setAttribute("href",`data:text/plain;charset=utf-8,${encodeURIComponent(t)}`),n.setAttribute("download",e),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)},W=(e,t)=>fetch(e,{headers:{"Content-Type":"application/json",...t==null?void 0:t.headers},...t}),K={bulkcreate:({parentId:e,create:t,templateType:n}={})=>{const r=new URLSearchParams;e&&r.set("parent_id",e),t&&r.set("create",t?"true":"false"),n&&r.set("template_type",n);const s=r.toString();return`/plugin/inventree-bulk-plugin/bulkcreate${s?`?${s}`:""}`},templates:({id:e,templateType:t}={})=>{const n=new URLSearchParams;t&&n.set("template_type",t);const r=n.toString();return`/plugin/inventree-bulk-plugin/templates${e!=null?`/${e}`:""}${r?`?${r}`:""}`}},Ye=10,pt=({template:e,height:t,parentId:n,bulkGenerateInfo:r})=>{const{showNotification:s}=oe(),a=ee(),i=J(()=>`preview-table-${a}`,[a]);return A(()=>{(async()=>{const u=await W(K.bulkcreate({parentId:n,create:!1}),{method:"POST",body:JSON.stringify({...e,template:JSON.stringify(he(e.template))})}),d=await u.json();if(!u.ok)return s({type:"danger",message:`An error occurred, ${d.error}`});const o=_t(d,Pt());s({type:"success",message:`Successfully parsed. This will generate ${o.length} items.`});const b=St(e.template),c=$(`#${i}`),f={},m=(y,h,v)=>{if(h===void 0)return"";if(y.field_type==="model"){const k=p=>{const g=(()=>{var V;if(G[y.model.model]&&(p=G[y.model.model].mapFunction(p)),(V=p.element)!=null&&V.instance&&(p=p.element.instance),G[y.model.model])return G[y.model.model].render(p);const L=j=>{if(!j.pk)return"";const B=y.model.model.toLowerCase().split(".").at(-1);return`${renderModelData("",B,j,{})} <span>(${j.pk})</span>`},E=p.count;if(y.allow_multiple&&p.results&&(p=p.results),y.allow_multiple&&Array.isArray(p)){let j=!1,B="";return E===void 0?(j=E>p.length,B=`${E-p.length} more elements`):p.length>=Ye&&(p.pop(),j=!0,B="at least one more element"),`${`<li>${p.map(L).join("</li><li>")}</li>`}${j?`<li>... ${B}</li>`:""}`}return L(p)})(),x=document.getElementById(v);x&&(x.innerHTML=g,x.classList.remove("placeholder","placeholder-glow","col-4"),c.bootstrapTable("resetView"))},_=G[y.model.model];if(_!=null&&_.getSingle){const p=`~get-single-${h}`;f[p]||(f[p]=[],_.getSingle(h,g=>f[p].forEach(x=>x(g)))),f[p].push(k)}else{let p=`${h}/`,g={...y.model.limit_choices_to};Number.isNaN(parseInt(h,10))&&(p="",g={...JSON.parse(h),...g},"name"in g&&(g.search=g.name));const x=`${y.model.api_url}/${p}?limit=${Ye}`.replace("//","/"),L=`~get-api-${x}-${JSON.stringify(h)}`;f[L]||(f[L]=[],inventreeGet(x,{...g},{success:E=>{f[L].forEach(V=>V(E))}})),f[L].push(k)}return`<span id=${v} class="placeholder placeholder-glow col-4">${h}</span>`}return y.field_type==="select"?ke(y.options[h]??`${h}`):y.field_type==="list"&&Array.isArray(h)?`<ul>${h.map((k,_)=>`<li>${m(y.items_type,k,`${v}-${_}`)}</li>`).join("")}</ul>`:y.field_type==="object"&&typeof h=="object"?`<ul>${Object.entries(h).map(([k,_],p)=>`<li>${ke(y.fields[k].name??k)}: ${m(y.fields[k],_,`${v}-${p}`)}</li>`).join("")}</ul>`:ke(`${h}`)};c.bootstrapTable("destroy"),c.bootstrapTable({data:o,idField:"id",height:t,columns:[...Object.entries(r.fields).filter(([y])=>b.includes(y)).map(([y,h])=>({field:y,title:h.name,formatter:(v,k,_,p)=>m(h,v,`table-${a}-field-${_}-${p}`)})),{field:"path",title:"Path"}],treeShowField:"name",parentIdField:"pid",onPostBody(){const y=c.bootstrapTable("getOptions").columns;y&&y[0][1].visible&&c.treegrid({treeColumn:0,onChange(){c.bootstrapTable("resetView")}})},rowStyle:()=>({css:{padding:"2px 0.5rem"}})})})()},[r.fields,t,a,n,s,i,e]),l("div",{class:"mt-3",children:l("table",{id:i,style:{whiteSpace:"nowrap"}})})},De=(e,t)=>({...e,template:{...e.template,input:Object.fromEntries(t.map(({key:n,value:r})=>[n,r]))}}),Lt=({template:e,parentId:t,attachPreviewHandler:n,attachCreateHandler:r,handleDoneCreate:s,setIsBulkCreateLoading:a})=>{const[i,u]=O(),[d,o]=O([]),[b,c]=O(!0),[f,m]=O(),{showNotification:y}=oe();A(()=>{!(e!=null&&e.template_type)||!t||(async()=>{const p=await W(K.bulkcreate({parentId:t,templateType:e.template_type}));if(!p.ok)return y({type:"danger",message:`Failed to load bulk generate info,
${p.statusText}`});const g=await p.json();m(g)})()},[t,y,e==null?void 0:e.template_type]),A(()=>{o(Object.entries(e.template.input).map(([p,g])=>({key:p,value:g})))},[e.template.input]);const h=w(p=>g=>{o(x=>x.map(({key:L,value:E})=>({key:L,value:p===L?g.currentTarget.value:E})))},[]),v=w(async()=>{a(!0);const p=De(e,d),g=await W(K.bulkcreate({parentId:t,create:!0}),{method:"POST",body:JSON.stringify({...p,template:JSON.stringify(he(p.template))})}),x=await g.json();if(a(!1),!g.ok)return s==null||s(!1),y({type:"danger",message:`An error occurred, ${x.error}`});y({type:"success",message:`Successfully bulk created ${x.length} ${f==null?void 0:f.name}s.`}),s==null||s(!0)},[f==null?void 0:f.name,s,d,t,a,y,e]),k=w(()=>{const p=structuredClone(De(e,d));u(p),c(!1)},[d,e]),_=w(()=>{v()},[v]);return A(()=>n==null?void 0:n(k),[n,k]),A(()=>r==null?void 0:r(_),[r,_]),l("div",{children:[l("h5",{children:"Inputs"}),l("div",{children:d.map(({key:p,value:g})=>l(R,{type:"text",label:p,value:g,onInput:h(p)},p))}),i&&f&&l(H,{children:[l("h5",{children:"Preview"}),l("div",{class:b?"mb-4":"",children:l(pt,{template:i,height:350,parentId:t,bulkGenerateInfo:f})})]})]})},ye=e=>e.default?e.default:e.field_type==="list"?[ye(e.items_type)]:e.field_type==="object"?Object.fromEntries(Object.entries(e.fields).filter(([,t])=>t.required).map(([t,n])=>[t,ye(n)])):e.field_type==="boolean"?!1:e.field_type==="float"||e.field_type==="number"?"0":"",ft=({fieldDefinition:e,field:t,setField:n,onDelete:r})=>e.field_type==="object"?l(mt,{fieldsDefinition:e,fields:t,setFields:n,onDelete:r}):e.field_type==="list"?l(Ut,{fieldsDefinition:e,fields:t,setFields:n,onDelete:r}):l(Gt,{fieldDefinition:e,field:t,setField:n,onDelete:r}),Ut=({fieldsDefinition:e,fields:t,setFields:n,onDelete:r})=>{const s=e.items_type,a=w(d=>o=>{n(b=>{const c=[...b];return c[d]=typeof o=="function"?o(c[d]):o,c})},[n]),i=w(()=>{const d=ye(s);n(o=>[...o,d])},[s,n]),u=w(d=>()=>{n(o=>o.filter((b,c)=>d!==c))},[n]);return l("div",{class:"mb-1 card",children:l("div",{class:"d-flex justify-content-between",children:[l("div",{className:"col p-2",children:[e.name&&l(Z,{text:e.description||"",children:l("h6",{children:e.name})}),l("div",{class:"ms-3",children:[t.map((d,o)=>l(ft,{fieldDefinition:s,field:d,setField:a(o),onDelete:u(o)})),l("div",{style:{display:"flex",justifyContent:"space-between"},children:l("button",{class:"btn btn-sm btn-outline-primary",onClick:i,children:["Add ",e.name]})})]})]}),r&&l("div",{class:"p-1",children:l("button",{onClick:r,class:"btn btn-sm btn-outline-danger",children:l("i",{class:"fa fa-trash"})})})]})})},mt=({fieldsDefinition:e,fields:t,setFields:n,onDelete:r,showCard:s=!0})=>{const a=e.fields,i=w(f=>m=>n(y=>({...y,[f]:typeof m=="function"?m(y[f]):m})),[n]),u=J(()=>{const f=Object.keys(t);return Object.entries(a).filter(([m])=>!f.includes(m))},[t,a]),[d,o]=O(""),b=w(f=>{if(f!==""){const m=a[f],y=ye(m);i(f)(y),o("")}},[a,i]),c=w(f=>()=>{n(m=>{const y={...m};return delete y[f],y})},[n]);return l("div",{class:`${s?"card mb-1":""}`,children:l("div",{class:"d-flex justify-content-between",children:[l("div",{class:`col ${s?"p-2":""}`,children:[e.name&&l(Z,{text:e.description||"",children:l("h6",{children:e.name})}),Object.entries(a).filter(([f])=>t[f]!==void 0).map(([f,m])=>{const y=t[f];return l(ft,{fieldDefinition:m,field:y,setField:i(f),onDelete:m.required?void 0:c(f)},f)}),u.length>0&&l("div",{style:"display: flex; max-width: 200px;",children:l("select",{class:"form-select form-select-sm",value:d,onInput:f=>b(f.currentTarget.value),children:[l("option",{selected:!0,value:"",children:"Add key"}),u.map(([f,{name:m}])=>l("option",{value:f,children:m}))]})})]}),r&&l("div",{class:"p-1",children:l("button",{onClick:r,class:"btn btn-sm btn-outline-danger",children:l("i",{class:"fa fa-trash"})})})]})})},Ft=e=>e.field_type==="boolean"?"Use a template that evaluates to something boolean like (e.g. 'true' or 'false').":e.field_type==="number"?"Use a template that evaluates to something number like (e.g. '10').":e.field_type==="float"?"Use a template that evaluates to something float like (e.g. '3.1415').":e.field_type==="model"?`Use a template that evaluates to a valid id for this model (e.g. '42') or a json string containing django model filters (e.g. {"name": "R_10k_0808_10%"} or {"name__startswith": "R_"}), but be aware that the preview table may not work correctly due to API limitations. Bulk create will work correctly then. ${e.allow_multiple?"The filters can also return multiple objects.":"The filters must return only one object."}`:e.field_type==="select"?`Use a template that evaluates to a valid option from the select field. Available options: ${Object.keys(e.options).join(", ")}`:"",Bt=(e,t)=>{const n=`${t}`;return e.field_type==="number"?!/^\d*$/.test(n):e.field_type==="float"?!/^[\d\\.,]*$/.test(n):e.field_type==="boolean"?!["true","false",""].includes(n):n.includes("{")||n.includes("}")},Gt=({fieldDefinition:e,field:t,setField:n,onDelete:r})=>{const[s,a]=O(()=>Bt(e,t)),i=J(()=>e.field_type!=="text",[e.field_type]),u=ee(),d=J(()=>s?"text":e.field_type,[e.field_type,s]);return l(H,{children:l(R,{label:e.name,tooltip:e.description||void 0,type:d,...e.field_type==="model"?{model:e.model}:{},...e.field_type==="select"?{options:e.options}:{},value:t,onInput:o=>n(o.currentTarget.value),onDelete:r,extraButtons:i&&l(H,{children:[l("input",{type:"checkbox",class:"btn-check",id:`btn-check-${u}`,checked:s,onInput:()=>a(o=>!o),autoComplete:"off"}),l("label",{class:"btn btn-sm btn-outline-primary",for:`btn-check-${u}`,style:"display: flex; align-items: center;",children:l(Z,{text:Ft(e),children:l("i",{class:"fas fa-code"})})})]})})})},Vt="1.3.1",Ue={version:Vt,input:{},templates:[],output:{parent_name_match:"true",dimensions:[""],count:[""],generate:{}}};function Ie({childSchema:e,setChildSchema:t,bulkGenerateInfo:n,extendsKeys:r}){var k;A(()=>{Object.keys(e.generate).length===0&&Object.keys(n.fields).length>0&&t(_=>({..._,generate:Object.fromEntries(Object.entries(n.fields).filter(([,{required:p}])=>!!p).map(([p])=>[p,""]))}))},[n.fields,e,t]);const s=w(_=>p=>t(g=>({...g,[_]:p.currentTarget.value})),[t]),a=w(_=>t(p=>({...p,generate:typeof _=="function"?_(p.generate):_})),[t]),i=w(_=>p=>g=>t(x=>(x[_][p]=typeof g=="function"?g(x[_][p]):g,{...x,[_]:x[_]})),[t]),u=w(()=>t(_=>(_.dimensions.push(""),_.count.push(""),{..._,dimensions:_.dimensions,count:_.count})),[t]),d=w(_=>()=>t(p=>({...p,dimensions:p.dimensions.filter((g,x)=>x!==_),count:p.count.filter((g,x)=>x!==_)})),[t]),o=w(_=>p=>t(g=>(g.childs||(g.childs=[]),g.childs[_]=typeof p=="function"?p(g.childs[_]):p,{...g,childs:g.childs})),[t]),b=w(()=>t(_=>(_.childs||(_.childs=[]),_.childs.push(structuredClone(Ue.output)),{..._,childs:_.childs})),[t]),c=w(_=>()=>t(p=>p.childs?{...p,childs:p.childs.filter((g,x)=>x!==_)}:p),[t]),m=`bulk-child-schema-editor-${ee()}`,[y,h]=O(!1),v=w(()=>{h(_=>($(`#${m}`).collapse(_?"hide":"show"),!_))},[m]);return l("div",{class:"",children:[l(R,{label:"Dimensions",tooltip:"A childs naming convention could have multiple dimensions where it is counting in",type:"array",onDelete:d,value:e.dimensions.map(_=>_||""),onInput:i("dimensions"),onAdd:u}),l(R,{label:"Count",tooltip:"Limit the amount of generated items for the individual dimension",type:"array",value:e.count.map(_=>_||""),onInput:i("count")}),l("h6",{class:`user-select-none collapsable-heading ${y?"active":""}`,role:"button",onClick:v,children:"Advanced"}),l("div",{class:"collapse",id:m,children:[n.generate_type==="tree"&&l(H,{children:[l(R,{label:"Parent name match",tooltip:"First child that matches the parent name matcher will be chosen for generating the childs for a specific parent. Must evaluate to something that can be casted to a boolean.",type:"text",value:e.parent_name_match||"",onInput:s("parent_name_match")}),r&&l(R,{label:"Extends",tooltip:"Choose to extend from a template",type:"select",options:r,value:e.extends||"",onInput:s("extends")})]}),l(R,{label:"Global context",tooltip:"This template gets imported under the 'global' namespace to all generate fields. Use this to setup variables via the set keyword ('{% set hello = 'world' %}')which can be accessed as 'global.<x>' ('{{ global.hello }}').",type:"textarea",value:e.global_context||"",onInput:s("global_context")})]}),l("div",{class:"mt-3",children:l(Z,{text:"You can use {{dim.x}} as a placeholder for the generated output of the dimension. For more info see the Readme.",children:l("h5",{children:"Generate"})})}),l(mt,{fieldsDefinition:{name:"",description:null,required:!0,field_type:"object",fields:n.fields},fields:e.generate,setFields:a,showCard:!1}),n.generate_type==="tree"&&l(H,{children:[l("h5",{class:"mt-3",children:"Childs"}),l("div",{class:"ms-3",children:(k=e.childs)==null?void 0:k.map((_,p)=>l("div",{class:"card mb-2",children:l("div",{class:"d-flex justify-content-between",children:[l("div",{class:"col p-3",children:l(Ie,{childSchema:_,setChildSchema:o(p),bulkGenerateInfo:n,extendsKeys:r})}),l("div",{class:"p-1",children:l("button",{onClick:c(p),class:"btn btn-sm btn-outline-danger",children:l("i",{class:"fa fa-trash"})})})]})}))}),l("button",{onClick:b,class:"btn btn-outline-primary btn-sm",children:"Add child"})]})]})}function Ht({schema:e,setSchema:t,bulkGenerateInfo:n}){const r=D(!0),s=w(h=>t(v=>({...v,output:typeof h=="function"?h(v.output):h})),[t]),[a,i]=O([]),u=w((h,v)=>k=>i(_=>(_[h][v]=k.currentTarget.value,[..._])),[i]),d=w(()=>i(h=>[...h,{key:"",value:""}]),[i]),o=w(h=>()=>i(v=>v.filter((k,_)=>_!==h)),[i]);A(()=>{a.length>0&&t(h=>({...h,input:Object.fromEntries(a.map(({key:v,value:k})=>[v,k]))}))},[a,t]),A(()=>{r.current&&(e!=null&&e.input)&&Object.keys(e.input).length!==0&&(i(Object.entries(e.input).map(([h,v])=>({key:h,value:v}))),r.current=!1)},[e==null?void 0:e.input,a,i]);const b=w(h=>v=>t(k=>(k.templates[h]=typeof v=="function"?v(k.templates[h]):v,{...k,templates:k.templates})),[t]),c=w(()=>t(h=>(h.templates.push({name:"",...structuredClone(Ue.output)}),{...h,templates:h.templates})),[t]),f=w(h=>()=>t(v=>({...v,templates:v.templates.filter((k,_)=>_!==h)})),[t]),m=J(()=>({"":"---",...e?Object.fromEntries(e.templates.filter(h=>h&&h.name).map(h=>[h.name,h.name])):{}}),[e]),y=ee();return l("div",{children:[l("div",{class:"card",children:[l("div",{class:"card-header",children:l("h5",{class:"mb-0 user-select-none",role:"button","data-bs-toggle":"collapse","data-bs-target":`#accordion-${y}-input`,children:"Input"})}),l("div",{id:`accordion-${y}-input`,class:"collapse",children:l("div",{class:"card-body",children:[a.map((h,v)=>l("div",{class:"input-group input-group-sm mb-2",children:[l("span",{class:"input-group-text",children:"Key"}),l("input",{type:"text",value:h.key,onInput:u(v,"key")}),l("span",{class:"input-group-text",children:"Value"}),l("input",{type:"text",style:"flex: 1;",value:h.value,onInput:u(v,"value")}),l("button",{class:"btn btn-outline-danger btn-sm",onClick:o(v),children:l("i",{class:"fa fa-trash"})})]})),l("button",{onClick:d,class:"btn btn-outline-primary btn-sm",children:"Add input"})]})})]}),n.generate_type==="tree"&&l(H,{children:l("div",{class:"card mt-2",children:[l("div",{class:"card-header",children:l("h5",{class:"mb-0 user-select-none",role:"button","data-bs-toggle":"collapse","data-bs-target":`#accordion-${y}-templates`,children:"Templates"})}),l("div",{id:`accordion-${y}-templates`,class:"collapse",children:l("div",{class:"card-body",children:[e.templates.map((h,v)=>l("div",{class:"card mb-2",children:l("div",{class:"d-flex justify-content-between",children:[l("div",{class:"col p-3",children:[h!==null&&l(R,{label:"Template name",type:"text",value:h.name,onInput:k=>b(v)(_=>({..._,name:k.currentTarget.value}))}),l(Ie,{childSchema:h,setChildSchema:b(v),bulkGenerateInfo:n,extendsKeys:m})]}),l("div",{class:"p-1",children:l("button",{onClick:f(v),class:"btn btn-sm btn-outline-danger",children:l("i",{class:"fa fa-trash"})})})]})})),l("button",{onClick:c,class:"btn btn-outline-primary btn-sm",children:"Add template"})]})})]})}),l("div",{class:"card mt-2",children:[l("div",{class:"card-header",children:l("h5",{class:"mb-0 user-select-none",role:"button","data-bs-toggle":"collapse","data-bs-target":`#accordion-${y}-output`,children:"Output"})}),l("div",{id:`accordion-${y}-output`,class:"collapse show",children:l("div",{class:"card-body",children:l(Ie,{childSchema:e.output,setChildSchema:s,bulkGenerateInfo:n,extendsKeys:m})})})]})]})}const ht=st({bulkGenerateInfoDict:{},reload:async()=>{}}),Mt=()=>{const{bulkGenerateInfoDict:e,reload:t}=it(ht);return{bulkGenerateInfoDict:e,reload:t}},Rt=({children:e})=>{const[t,n]=O({}),{showNotification:r}=oe(),s=w(async()=>{const a=await W(K.bulkcreate());if(!a.ok)return r({type:"danger",message:`Could not load bulk generate info, ${a.statusText}`});const i=Object.fromEntries((await a.json()).map(u=>[u.template_type,u]));n(i)},[r]);return A(()=>{s()},[s]),l(ht.Provider,{value:{bulkGenerateInfoDict:t,reload:s},children:e})},Wt=({templateId:e,handleBack:t,templateType:n,parentId:r,initialTemplate:s})=>{var Fe;const[a,i]=O(null),[u,d]=O(null),[o,b]=O(null),c=J(()=>!je(o,a),[o,a]),f=w(C=>U=>b(M=>M?{...M,[C]:U.currentTarget.value}:null),[]),m=w(C=>{b(U=>U===null?U:{...U,template:typeof C=="function"?C(U.template):C})},[]),[y,h]=O(!0),[v,k]=O(!0),[_,p]=O(),{showNotification:g}=oe(),{bulkGenerateInfoDict:x}=Mt(),L=J(()=>Object.fromEntries(Object.values(x).map(C=>[C.template_type,C.name])),[x]);A(()=>{!(o!=null&&o.template_type)||!r||(k(!0),(async()=>{const C=await W(K.bulkcreate({parentId:r,templateType:o.template_type}));if(!C.ok)return k(!1),g({type:"danger",message:`Failed to load bulk generate info,
${C.statusText}`});const U=await C.json();p(U),k(!1)})())},[r,g,o==null?void 0:o.template_type]);const E=J(()=>!e&&!(o!=null&&o.id),[o==null?void 0:o.id,e]),V=w(async()=>{h(!0);let C=null;if(s)C=structuredClone(s);else if(e){const U=await W(K.templates({id:e}));if(!U.ok)return h(!1),g({type:"danger",message:`Fetching template failed,
${U.statusText}`});const M=await U.json();C={...M,template:JSON.parse(M.template)}}else C={id:null,name:"",template:structuredClone(Ue),template_type:n||"STOCK_LOCATION"};i(structuredClone(C)),b(structuredClone(C)),h(!1)},[s,g,e,n]);A(()=>{V()},[V]);const j=w(async()=>{if(!o)return!1;const C=await W(K.templates({id:E?null:o.id}),{method:E?"POST":"PUT",body:JSON.stringify({...o,template:JSON.stringify(he(o.template))})}),U=await C.json();return C.ok?(E?(o.id=U.id,b({...o}),g({type:"success",message:"Template successfully created."})):g({type:"success",message:"Template successfully updated."}),i(structuredClone(o)),!0):(g({type:"danger",message:`An error occurred. ${Object.entries(U).map(([M,yt])=>`${M}: ${yt.join(", ")}`).join(", ")}`,autoHide:!1}),!1)},[E,g,o]),B=w(()=>b(structuredClone(a)),[a]),T=w(()=>{d(structuredClone(o))},[o]),[S,F]=O(!1),[q,se]=O(!1),ae=w(async()=>{var M;if(o===null)return;se(!0);const C=await W(K.bulkcreate({parentId:r,create:!0}),{method:"POST",body:JSON.stringify({...o,template:JSON.stringify(he(o.template))})}),U=await C.json();if(se(!1),F(!1),!C.ok)return g({type:"danger",message:`An error occurred, ${U.error}`});g({type:"success",message:`Successfully bulk created ${U.length} ${(M=x[o.template_type])==null?void 0:M.name}s.`})},[x,r,g,o]),ie=w(()=>{const C=`${Date.now()}_${o==null?void 0:o.name}.json`;At(C,JSON.stringify({name:o==null?void 0:o.name,template_type:o==null?void 0:o.template_type,template:o==null?void 0:o.template})),g({type:"success",message:`Successfully downloaded template '${o==null?void 0:o.name}' as '${C}'.`})},[g,o==null?void 0:o.name,o==null?void 0:o.template,o==null?void 0:o.template_type]),ce=w(()=>{navigator.clipboard.writeText(JSON.stringify({name:o==null?void 0:o.name,template_type:o==null?void 0:o.template_type,template:o==null?void 0:o.template})).then(()=>g({type:"success",message:`Successfully copied template '${o==null?void 0:o.name}' to clipboard.`})).catch(C=>g({type:"danger",message:`Error copying template '${o==null?void 0:o.name}' to clipboard. ${C}`}))},[g,o==null?void 0:o.name,o==null?void 0:o.template,o==null?void 0:o.template_type]),[ge,ve]=O(!1);return l("div",{children:[l("h5",{children:[E?"Create":"Edit"," ",E?"":`"${o==null?void 0:o.name}" `,"template"]}),y&&l("div",{class:"d-flex justify-content-center",children:l("div",{class:"spinner-border",role:"status",children:l("span",{class:"visually-hidden",children:"Loading..."})})}),!y&&!v&&_&&o&&l("div",{children:[l(R,{label:"Name",type:"text",value:o.name,onInput:f("name")}),!n&&l(R,{label:"Template type",type:"select",value:o.template_type,options:L,onInput:f("template_type")}),l(Ht,{schema:o.template,setSchema:m,bulkGenerateInfo:_})]}),l("div",{class:"d-flex mt-2",style:"gap: 5px",children:[l("button",{class:"btn btn-outline-primary",onClick:()=>c?ve(!0):t(),children:"Back"}),l("button",{class:`btn ${c?"btn-outline-success":"btn-outline-secondary"}`,onClick:j,disabled:!c,children:E?"Create":"Update"}),!E&&l("button",{class:`btn ${c?"btn-outline-danger":"btn-outline-secondary"}`,onClick:B,disabled:!c,children:"Reset"}),l("button",{class:"btn btn-outline-primary",onClick:T,children:"Preview"}),r&&l("button",{class:"btn btn-outline-primary",onClick:()=>F(!0),children:"Bulk create"}),l("div",{class:"btn-group btn-group-sm",children:[l("button",{class:"btn btn-outline-primary px-3",onClick:ce,children:l(Z,{text:"Copy to clipboard",placement:"top",children:l("i",{class:"fas fa-clipboard"})})}),l("button",{class:"btn btn-outline-primary px-3",onClick:ie,alt:"Download as file",children:l(Z,{text:"Download as file",placement:"top",children:l("i",{class:"fas fa-download"})})})]})]}),u&&_&&l(pt,{template:u,parentId:r,bulkGenerateInfo:_}),l(te,{title:"Bulk create",show:S,onClose:()=>{F(!1)},actions:[{label:"Bulk create",type:"primary",onClick:ae,disabled:q,loading:q}],children:["Are you sure you want to bulk generate"," ",((Fe=x[(o==null?void 0:o.template_type)||""])==null?void 0:Fe.name)||(o==null?void 0:o.template_type),"s here?"]}),l(te,{title:"Save the template",show:ge,onClose:()=>ve(!1),actions:[{label:"Don't save",type:"outline-danger",onClick:t},{label:"Save",type:"primary",onClick:()=>{j().then(C=>{ve(!1),C===!0&&t()})}}],children:"Do you want to save the template?"})]})},Kt=({templateType:e,parentId:t})=>{const[n,r]=O([]),[s,a]=O(!0),[i,u]=O(null),[d,o]=O("OVERVIEW"),{showNotification:b}=oe(),c=w(async()=>{a(!0);const T=await W(K.templates({templateType:e}));if(!T.ok)return a(!1),b({type:"danger",message:`Fetching templates failed,
${T.statusText}`});const S=await T.json();r(S.map(F=>({...F,template:JSON.parse(F.template)}))),a(!1)},[b,e]);A(()=>{c()},[c]);const f=w((T,S)=>()=>{o(T),u(S)},[]),m=w(()=>{u(null),o("OVERVIEW"),c()},[c]),y=w(async()=>{if(i===null)return;const T=await W(K.templates({id:i.id}),{method:"DELETE"});if(!T.ok)return b({type:"danger",message:`Deleting template failed,
${T.statusText}`});u(null),o("OVERVIEW"),r(S=>[...S.filter(F=>F.id!==i.id)]),b({type:"success",message:"Template successfully deleted."})},[i,b]),h=D(()=>{}),v=D(()=>{}),k=w(()=>{x(!1),u(null),o("OVERVIEW")},[]),[_,p]=O(!1),[g,x]=O(!1),L=w(T=>{const S=JSON.parse(T);if(!("template_type"in S)||!("name"in S)||!("template"in S))throw new Error("invalid format");if(e&&e!==S.template_type)throw new Error(`Template type ${S.template_type} cannot be imported as a ${e} template.`);f("EDITING",{id:null,...S})()},[f,e]),E=D(null),[V,j]=O(!1),B=w(()=>{var T,S;try{const F=(S=(T=E.current)==null?void 0:T.files)==null?void 0:S[0],q=new FileReader;q.onload=se=>{var ae,ie,ce;try{L(((ie=(ae=se.target)==null?void 0:ae.result)==null?void 0:ie.toString())||""),(ce=E.current)!=null&&ce.value&&(E.current.value="")}catch(ge){b({type:"danger",message:`Cannot import from file. ${ge}`})}},q.readAsText(F,"UTF-8")}catch(F){b({type:"danger",message:`Cannot import from file. ${F}`})}},[L,b]);return d==="EDITING"?l("div",{children:l(Wt,{handleBack:m,templateId:i==null?void 0:i.id,templateType:e,parentId:t,initialTemplate:(i==null?void 0:i.id)===null?i:void 0})}):l("div",{children:[l("table",{class:"table table-bordered",style:"max-width: 500px",children:[l("thead",{children:l("tr",{children:[l("th",{children:"Name"}),l("th",{children:"Actions"})]})}),l("tbody",{children:s?l("tr",{children:l("td",{colSpan:2,children:l("div",{class:"d-flex justify-content-center",children:l("div",{class:"spinner-border",role:"status",children:l("span",{class:"visually-hidden",children:"Loading..."})})})})}):n.map(T=>l("tr",{children:[l("td",{children:T.name}),l("td",{children:[l("button",{class:"btn btn-sm btn-outline-danger me-1",onClick:f("DELETING",T),children:"Delete"}),l("button",{class:"btn btn-sm btn-outline-success me-1",onClick:f("EDITING",T),children:"Edit"}),l("button",{class:"btn btn-sm btn-outline-primary",onClick:f("PREVIEWING",T),children:"Preview/Bulk create"})]})]}))})]}),l("div",{class:"btn-group",children:[l("button",{type:"button",class:"btn btn-outline-primary",onClick:f("EDITING",null),children:"New untitled schema"}),l("button",{class:"btn btn-outline-primary dropdown-toggle dropdown-toggle-split","data-bs-toggle":"dropdown","aria-expanded":"false"}),l("ul",{class:"dropdown-menu",children:[l("li",{children:l("button",{class:"dropdown-item",onClick:()=>navigator.clipboard.readText().then(T=>L(T)).catch(T=>b({type:"danger",message:`Error importing from clipboard, ${T}`})),children:"From clipboard"})}),l("li",{children:l("button",{class:"dropdown-item",onClick:()=>f("IMPORT_TEMPLATE",null)(),children:"From file"})})]})]}),l(te,{title:"Delete template",show:d==="DELETING",onClose:()=>{u(null),o("OVERVIEW")},actions:[{label:"Delete",type:"danger",onClick:y}],children:['Are you sure you want to delete the template "',i==null?void 0:i.name,'"?']}),l(te,{title:"Preview/bulk create from template",show:d==="PREVIEWING",onClose:k,actions:[{label:"Preview",type:"primary",onClick:()=>{h.current(),x(!0)}},{label:"Bulk create",type:"outline-primary",onClick:()=>v.current(),disabled:_||!g,loading:_}],children:i&&l(H,{children:[l(Lt,{template:i,parentId:t,attachPreviewHandler:T=>{h.current=T},attachCreateHandler:T=>{v.current=T},handleDoneCreate:T=>{T&&k()},setIsBulkCreateLoading:p}),!g&&l("i",{children:"You need to preview the items first."})]})}),l(te,{title:"Import template",show:d==="IMPORT_TEMPLATE",onClose:()=>{var T;u(null),o("OVERVIEW"),(T=E.current)!=null&&T.value&&(E.current.value="")},actions:[{label:"Import",type:"outline-primary",onClick:B,disabled:!V}],children:l("input",{type:"file",onInput:T=>{var S,F,q;return j(!((q=(F=(S=T.current)==null?void 0:S.target)==null?void 0:F.files)!=null&&q[0]))},ref:E})})]})},Jt=({children:e})=>l(It,{children:l(Rt,{children:e})});function qt({target:e,objectId:t,objectType:n}){Tt(l(Jt,{children:l(Kt,{templateType:n,parentId:t})}),e)}export{qt as render};
