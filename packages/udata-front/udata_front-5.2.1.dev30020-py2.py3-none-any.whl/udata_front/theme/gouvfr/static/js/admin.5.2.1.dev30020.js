import{openBlock as d,createElementBlock as p,unref as t,createElementVNode as e,renderSlot as O,defineComponent as M,Fragment as P,toDisplayString as o,createVNode as i,normalizeClass as Y,ref as $,onMounted as V,mergeProps as ie,computed as U,createBlock as q,withCtx as _,createTextVNode as k,renderList as J,createCommentVNode as A,readonly as me,watchEffect as se,resolveComponent as B,watchPostEffect as pe,Teleport as Q,withModifiers as K,createApp as be}from"vue";import{x as T,B as D,bg as he,F,_ as H,b as ge,g as ve,bh as ye,y as $e,H as ee,C as we,E as N,af as oe,b0 as de,bi as ke,ao as ce,b4 as Ae,bj as ze,bk as Ce,ak as Me,I as qe,ab as Se,aL as X,X as ae,aY as Te,bl as Re,bm as ue,U as E,a5 as Pe,aI as fe,bn as Ie,ap as Oe,W as G,$ as De,bo as Fe,bp as Be,aD as Ue,bq as Le,br as re,bs as Ee,bt as Ve,bu as He,bv as je,bw as Ne,bx as We,a$ as Ye,by as Ze,bz as Je,b6 as Ke,b9 as te,aK as Qe,ba as Xe,bb as Ge,bc as xe,bA as et,bB as tt,bd as st,be as ot,bf as at}from"./sentry.5.2.1.dev30020.js";import"vue-content-loader";import"./_commonjsHelpers.5.2.1.dev30020.js";function Pa(){import.meta.url,import("_").catch(()=>1);async function*g(){}}const rt=["aria-label"],nt={class:"fr-breadcrumb__list"},Z={__name:"Breadcrumb",setup(g){const{t:s}=T();return(a,m)=>(d(),p("nav",{rol:"navigation","aria-label":t(s)("You're here:"),class:"fr-breadcrumb fr-mb-5v"},[e("ol",nt,[O(a.$slots,"default")])],8,rt))}},lt={class:"fr-text--sm fr-my-0"},it={class:"fr-grid-row fr-grid-row--right not-enlarged"},dt=["href","title"],ct=M({__name:"QualityScoreTooltipContent",props:{dataset:{}},setup(g){const{t:s}=T();return(a,m)=>(d(),p(P,null,[e("h5",lt,o(t(s)("Metadata quality:")),1),i(t(D),{passed:a.dataset.quality.dataset_description_quality,messagePassed:t(s)("Data description filled"),messageFailed:t(s)("Data description empty"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),i(t(D),{passed:a.dataset.quality.resources_documentation,messagePassed:t(s)("Files documented"),messageFailed:t(s)("Files documentation missing"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),i(t(D),{passed:a.dataset.quality.license,messagePassed:t(s)("License filled"),messageFailed:t(s)("No license set"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),i(t(D),{passed:a.dataset.quality.update_frequency&&!!a.dataset.quality.update_fulfilled_in_time,messagePassed:t(s)("Update frequency followed"),messageFailed:a.dataset.quality.update_frequency?t(s)("Update frequency not followed"):t(s)("Update frequency not set"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),i(t(D),{passed:a.dataset.quality.has_open_format,messagePassed:t(s)("File formats are open"),messageFailed:t(s)("File formats are closed"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),i(t(D),{passed:a.dataset.quality.temporal_coverage,messagePassed:t(s)("Temporal coverage filled"),messageFailed:t(s)("Temporal coverage not set"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),i(t(D),{passed:a.dataset.quality.spatial,messagePassed:t(s)("Spatial coverage filled"),messageFailed:t(s)("Spatial coverage not set"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),i(t(D),{passed:a.dataset.quality.all_resources_available,messagePassed:t(s)("All files are available"),messageFailed:t(s)("Some files are unavailable"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),e("div",it,[e("a",{href:t(he),target:"_blank",rel:"noopener",title:t(s)("Learn more about this indicator - opens a new window")},o(t(s)("Learn more about this indicator")),9,dt)])],64))}}),ut=M({__name:"AdminBadge",props:{type:{}},setup(g){return(s,a)=>(d(),p("p",{class:Y(["fr-badge",{"fr-badge--blue-cumulus":s.type==="info","fr-badge--error fr-badge--no-icon":s.type==="error","fr-badge--warning fr-badge--no-icon":s.type==="warning","fr-badge--success fr-badge--no-icon":s.type==="success"}])},[O(s.$slots,"default")],2))}}),ft=["aria-describedby"],_t=["id"],mt=M({inheritAttrs:!1,__name:"AdminContentWithTooltip",setup(g){const s=F(),a=$(),m=$("");return V(()=>{a.value&&(m.value=a.value.textContent||"")}),(r,n)=>(d(),p(P,null,[e("p",ie(r.$attrs,{"aria-describedby":t(s),ref_key:"contentRef",ref:a}),[O(r.$slots,"default",{},void 0,!0)],16,ft),e("span",{class:"fr-hidden-xl fr-tooltip fr-placement",id:t(s),role:"tooltip","aria-hidden":"true"},o(m.value),9,_t)],64))}});const pt=H(mt,[["__scopeId","data-v-d192f17a"]]);const bt={},ht={class:"fr-table fr-mb-0"};function gt(g,s){return d(),p("div",ht,[e("table",null,[O(g.$slots,"default",{},void 0,!0)])])}const vt=H(bt,[["render",gt],["__scopeId","data-v-fabe0a06"]]),yt={class:"fr-text--bold"},$t={key:1,class:"fr-grid-row fr-grid-row--middle justify-between"},wt=["title"],kt=M({__name:"AdminTableTh",props:{sorted:{}},emits:["sort"],setup(g,{emit:s}){const a=g,m=s,{t:r}=T(),n=U(()=>a.sorted!==void 0);function u(){return a.sorted==="desc"?m("sort","asc"):m("sort","desc")}return(f,y)=>(d(),p("th",yt,[n.value?(d(),p("div",$t,[O(f.$slots,"default",{},void 0,!0),e("button",{class:Y(["fr-ml-1w fr-btn fr-btn--sm fr-btn--tertiary-no-outline",{"fr-icon-arrow-down-line":!f.sorted||f.sorted==="asc","fr-icon-arrow-up-line":f.sorted==="desc","text-grey-500":f.sorted,"text-mention-grey":!f.sorted}]),onClick:u,title:t(r)("Sort")},o(t(r)("Sort")),11,wt)])):O(f.$slots,"default",{key:0},void 0,!0)]))}});const I=H(kt,[["__scopeId","data-v-5acf0bf0"]]),At=["aria-describedby"],zt=["id"],L=M({__name:"Tooltip",setup(g){const s=F("tooltip");return(a,m)=>(d(),p(P,null,[e("p",ie(a.$attrs,{"aria-describedby":t(s)}),[O(a.$slots,"default")],16,At),e("span",{class:"fr-tooltip fr-placement",id:t(s),role:"tooltip","aria-hidden":"true"},[O(a.$slots,"tooltip")],8,zt)],64))}}),Ct=M({__name:"AdminLoader",props:{scale:{default:4}},setup(g){return ge(ye),(s,a)=>(d(),q(t(ve),{name:"ri-loader-5-line",animation:"spin",scale:s.scale,fill:"var(--blue-cumulus-sun-368-moon-732)"},null,8,["scale"]))}}),Mt={class:"fr-mb-2w"},qt=["href"],St={class:"monospace"},Tt={class:"monospace"},Rt={class:"monospace"},Pt={class:"monospace"},It={class:"monospace"},Ot=M({__name:"AdminDatasetsTable",props:{datasets:{},loading:{type:Boolean},sortDirection:{},sortedBy:{}},emits:["sort"],setup(g,{emit:s}){const a=s,m=g,{t:r}=T();function n(v,c){a("sort",v,c)}function u(v){return m.sortedBy===v?m.sortDirection:null}function f(v){return Array.isArray(v.resources)?v.resources.length:v.resources.total}function y(v){return"".concat(de,"dataset/").concat(v.id,"/")}function w(v){return v.deleted?{label:r("Deleted"),type:"error"}:v.archived?{label:r("Archived"),type:"warning"}:v.private?{label:r("Private"),type:"default"}:{label:r("Public"),type:"info"}}return(v,c)=>(d(),p("div",Mt,[i(vt,null,{default:_(()=>[e("thead",null,[e("tr",null,[i(I,{onSort:c[0]||(c[0]=l=>n("title",l)),sorted:u("title"),scope:"col"},{default:_(()=>[k(o(t(r)("Title of the dataset")),1)]),_:1},8,["sorted"]),i(I,{scope:"col"},{default:_(()=>[k(o(t(r)("Status")),1)]),_:1}),i(I,{onSort:c[1]||(c[1]=l=>n("created",l)),sorted:u("created"),scope:"col"},{default:_(()=>[k(o(t(r)("Created at")),1)]),_:1},8,["sorted"]),i(I,{onSort:c[2]||(c[2]=l=>n("last_update",l)),sorted:u("last_update"),scope:"col"},{default:_(()=>[k(o(t(r)("Updated at")),1)]),_:1},8,["sorted"]),i(I,{scope:"col"},{default:_(()=>[k(o(t(r)("Files")),1)]),_:1}),i(I,{scope:"col"},{default:_(()=>[k(o(t(r)("Score")),1)]),_:1}),i(I,{scope:"col"},{default:_(()=>[i(L,null,{tooltip:_(()=>[k(o(t(r)("Discussions")),1)]),default:_(()=>[c[6]||(c[6]=e("span",{class:"fr-icon--sm fr-icon-chat-3-line","aria-hidden":"true"},null,-1))]),_:1})]),_:1}),i(I,{onSort:c[3]||(c[3]=l=>n("views",l)),sorted:u("views"),scope:"col"},{default:_(()=>[i(L,null,{tooltip:_(()=>[k(o(t(r)("Views")),1)]),default:_(()=>[c[7]||(c[7]=e("span",{class:"fr-icon--sm fr-icon-eye-line","aria-hidden":"true"},null,-1))]),_:1})]),_:1},8,["sorted"]),i(I,{scope:"col"},{default:_(()=>[i(L,null,{tooltip:_(()=>[k(o(t(r)("Downloads")),1)]),default:_(()=>[c[8]||(c[8]=e("span",{class:"fr-icon--sm fr-icon-download-line","aria-hidden":"true"},null,-1))]),_:1})]),_:1}),i(I,{onSort:c[4]||(c[4]=l=>n("reuses",l)),sorted:u("reuses"),scope:"col"},{default:_(()=>[i(L,null,{tooltip:_(()=>[k(o(t(r)("Reuses")),1)]),default:_(()=>[c[9]||(c[9]=e("span",{class:"fr-icon--sm fr-icon-line-chart-line","aria-hidden":"true"},null,-1))]),_:1})]),_:1},8,["sorted"]),i(I,{onSort:c[5]||(c[5]=l=>n("followers",l)),sorted:u("followers"),scope:"col"},{default:_(()=>[i(L,null,{tooltip:_(()=>[k(o(t(r)("Favorites")),1)]),default:_(()=>[c[10]||(c[10]=e("span",{class:"fr-icon--sm fr-icon-star-s-line","aria-hidden":"true"},null,-1))]),_:1})]),_:1},8,["sorted"])])]),e("tbody",null,[(d(!0),p(P,null,J(v.datasets,l=>{var b;return d(),p("tr",{key:l.id},[e("td",null,[i(pt,null,{default:_(()=>[e("a",{class:"fr-link fr-reset-link",href:y(l)},[i(t($e),{text:l.title,"auto-resize":!0,"max-lines":2},null,8,["text"])],8,qt)]),_:2},1024)]),e("td",null,[i(ut,{type:w(l).type},{default:_(()=>[k(o(w(l).label),1)]),_:2},1032,["type"])]),e("td",null,o(t(ee)(l.created_at)),1),e("td",null,o(t(ee)(l.last_modified)),1),e("td",null,o(f(l)),1),e("td",null,[i(L,null,{tooltip:_(()=>[i(ct,{dataset:l},null,8,["dataset"])]),default:_(()=>[i(t(we),{class:"w-100",score:l.quality.score},null,8,["score"])]),_:2},1024)]),e("td",St,o(t(N)(l.metrics.discussions)),1),e("td",Tt,o(t(N)(l.metrics.views)),1),e("td",Rt,o(t(N)((b=l.metrics.resources_downloads)!=null?b:0)),1),e("td",Pt,o(t(N)(l.metrics.reuses)),1),e("td",It,o(t(N)(l.metrics.followers)),1)])}),128))])]),_:1}),v.loading?(d(),q(oe,{key:0,class:"fr-p-4w text-align-center"},{default:_(()=>[i(Ct)]),_:1})):A("",!0)]))}}),ne=$(null);function x(){const g=s=>{ne.value=s};return{currentOrganization:me(ne),setCurrentOrganization:g}}const Dt="/_themes/gouvfr/assets/logotype-white.svg",Ft=["href"],Bt=["src","alt"],Ut=M({__name:"AdminPublishButton",setup(g){const{t:s}=T();return(a,m)=>(d(),p("a",{href:t(ke),class:"fr-btn fr-icon-add-line fr-btn--icon-left"},[k(o(t(s)("Publish on"))+" ",1),e("img",{class:"fr-ml-1v",src:t(Dt),loading:"lazy",alt:t(ce)},null,8,Bt)],8,Ft))}}),Lt={key:0},Et={class:"fr-breadcrumb__link","aria-current":"page"},Vt={class:"fr-h3 fr-mb-5v"},Ht={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle"},jt={class:"fr-col"},Nt={class:"subtitle subtitle--uppercase fr-m-0"},Wt={key:0,class:"fr-col-auto fr-grid-row fr-grid-row--middle"},Yt=["href"],Zt={class:"text-align-center fr-py-1w"},Jt=["src"],Kt={class:"fr-text--bold fr-my-3v"},Qt=M({__name:"Datasets",props:{oid:{}},setup(g){const{t:s}=T(),a=g,m=$([]),r=$(!1),n=$(1),u=$(10),f=$(0),y=$("created"),w=$("asc"),v=U(()=>"".concat(w.value==="asc"?"":"-").concat(y.value)),c=$(""),l=Ae(c,Se),{currentOrganization:b}=x();function z(h,C){y.value=h,w.value=C}return se(async()=>{r.value=!0,m.value=[];try{const h=await ze(a.oid,l.value,n.value,u.value,v.value);m.value=h.data,n.value=h.page,u.value=h.page_size,f.value=h.total}finally{r.value=!1}}),(h,C)=>{const R=B("router-link");return d(),p("div",null,[i(Z,null,{default:_(()=>[e("li",null,[i(R,{class:"fr-breadcrumb__link",to:"/"},{default:_(()=>[k(o(t(s)("Administration")),1)]),_:1})]),t(b)?(d(),p("li",Lt,[i(R,{class:"fr-breadcrumb__link",to:"/"},{default:_(()=>[k(o(t(b).name),1)]),_:1})])):A("",!0),e("li",null,[e("a",Et,o(t(s)("Datasets")),1)])]),_:1}),e("h1",Vt,o(t(s)("Datasets")),1),e("div",Ht,[e("div",jt,[e("h2",Nt,o(t(s)("{n} datasets",f.value)),1)]),f.value?(d(),p("div",Wt,[e("div",null,[e("a",{href:t(Ce)(h.oid),class:"fr-btn fr-btn--sm fr-icon-download-line fr-btn--icon-left"},o(t(s)("Download catalog")),9,Yt)])])):A("",!0)]),i(Ot,{class:"fr-mt-1w",datasets:m.value,loading:r.value,"sort-direction":w.value,"sorted-by":y.value,onSort:z},null,8,["datasets","loading","sort-direction","sorted-by"]),!r.value&&f.value===0?(d(),q(oe,{key:0,class:"fr-mt-1w fr-mb-2w"},{default:_(()=>[e("div",Zt,[e("img",{src:t(Me),alt:"",loading:"lazy"},null,8,Jt),e("p",Kt,o(t(s)("You haven't published a dataset yet")),1),i(Ut)])]),_:1})):A("",!0),f.value>u.value?(d(),q(t(qe),{key:1,page:n.value,"page-size":u.value,"total-results":f.value,onChange:C[0]||(C[0]=S=>n.value=S)},null,8,["page","page-size","total-results"])):A("",!0)])}}}),Xt={class:"fr-container--fluid"},Gt={key:0},xt={class:"fr-breadcrumb__link","aria-current":"page"},es={class:"fr-alert fr-alert--info"},ts={class:"fr-alert__title"},ss=M({__name:"Reuses",props:{oid:{}},setup(g){const{t:s}=T(),a=g,m="/admin/organization/".concat(a.oid,"/"),r=$(null),n=$(null);return V(async()=>r.value=await X()),se(()=>{var u,f;n.value=(f=(u=r.value)==null?void 0:u.organizations.find(y=>y.id===a.oid))!=null?f:null}),(u,f)=>{const y=B("router-link");return d(),p("div",Xt,[i(Z,null,{default:_(()=>[e("li",null,[i(y,{class:"fr-breadcrumb__link",to:"/"},{default:_(()=>[k(o(t(s)("Administration")),1)]),_:1})]),n.value?(d(),p("li",Gt,[i(y,{class:"fr-breadcrumb__link",to:"/"},{default:_(()=>[k(o(n.value.name),1)]),_:1})])):A("",!0),e("li",null,[e("a",xt,o(t(s)("Reuses")),1)])]),_:1}),e("div",es,[e("h3",ts,o(t(s)("This is a WIP page")),1),e("p",null,[e("a",{href:m},o(t(s)("You can manage your reuses on the current admin.")),1)])])])}}}),os={class:"fr-breadcrumb__link","aria-current":"page"},as={key:0,class:"fr-h1"},rs={class:"fr-alert fr-alert--info"},ns={class:"fr-alert__title"},ls={href:"/admin/me/"},is=M({__name:"Me",setup(g){const{t:s}=T(),a=$(null);return V(async()=>a.value=await X()),(m,r)=>{const n=B("router-link");return d(),p("div",null,[i(Z,null,{default:_(()=>[e("li",null,[i(n,{class:"fr-breadcrumb__link",to:"/"},{default:_(()=>[k(o(t(s)("Administration")),1)]),_:1})]),e("li",null,[e("a",os,o(t(s)("Me")),1)])]),_:1}),a.value?(d(),p("h1",as,o(a.value.first_name)+" "+o(a.value.last_name),1)):A("",!0),e("div",rs,[e("h3",ns,o(t(s)("This is a WIP page")),1),e("p",null,[e("a",ls,o(t(s)("You can edit your profil on the current admin.")),1)])])])}}}),ds='<svg width="24" height="24" stroke-width="1.5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M5 12V18C5 18 5 21 12 21C19 21 19 18 19 18V12" stroke="currentColor" stroke-width="1.5"/>\n<path d="M5 6V12C5 12 5 15 12 15C19 15 19 12 19 12V6" stroke="currentColor" stroke-width="1.5"/>\n<path d="M12 3C19 3 19 6 19 6C19 6 19 9 12 9C5 9 5 6 5 6C5 6 5 3 12 3Z" stroke="currentColor" stroke-width="1.5"/>\n</svg>\n',cs={class:"fr-sidemenu__item"},us=["innerHTML"],fs=M({__name:"AdminSidebarLink",props:{label:{},icon:{},iconHtml:{},to:{}},setup(g){return(s,a)=>{const m=B("router-link");return d(),p("li",cs,[e("div",{class:Y([{"fr-icon-svg fr-icon--sm":s.iconHtml},"fr-enlarge-link fr-sidemenu__link fr-mb-1w"])},[s.iconHtml?(d(),p("div",{key:0,class:"fr-mr-1w fr-grid-row",innerHTML:s.iconHtml},null,8,us)):s.icon?(d(),p("div",{key:1,class:Y([s.icon,"fr-mr-1w fr-icon--sm"]),"aria-hidden":"true"},null,2)):A("",!0),i(m,{to:s.to},{default:_(()=>[k(o(s.label),1)]),_:1},8,["to"])],2)])}}});const W=H(fs,[["__scopeId","data-v-5e2ff0a8"]]),_s=["aria-expanded","aria-controls","aria-current"],ms={class:"fr-mx-1w"},ps={class:"logo logo--sm"},bs={class:"fr-mx-1w fr-col text-overflow-ellipsis"},hs=["id"],gs={class:"fr-sidemenu__list fr-mx-1w fr-my-3v"},vs=M({__name:"AdminSidebarMenu",props:{user:{},organization:{},isOpened:{type:Boolean}},emits:["open","click"],setup(g){const s=g,{t:a}=T(),m=F("menu");function r(n,u){const f=document.getElementById(m);u(f)&&(n?u(f).collapse.disclose():u(f).collapse.conceal())}return pe(()=>{setTimeout(()=>{r(s.isOpened,globalThis.dsfr)},200)}),(n,u)=>(d(),p("li",{class:Y(["fr-sidemenu__item",{"fr-sidemenu__item--active":n.isOpened}])},[e("button",{class:"fr-sidemenu__btn","aria-expanded":n.isOpened,"aria-controls":t(m),"aria-current":n.isOpened,onClick:u[0]||(u[0]=f=>n.$emit("open"))},[n.user?(d(),p(P,{key:0},[n.user?(d(),q(ae,{key:0,user:n.user,size:24,rounded:!0},null,8,["user"])):A("",!0),e("p",ms,o(t(a)("My Profil")),1)],64)):n.organization?(d(),p(P,{key:1},[e("div",ps,[i(Te,{type:"organization",src:n.organization.logo_thumbnail,size:20},null,8,["src"])]),e("p",bs,o(n.organization.name),1)],64)):A("",!0)],8,_s),e("div",{class:"fr-collapse","data-fr-js-collapse":"",id:t(m)},[e("ul",gs,[n.user?(d(),q(W,{key:0,icon:"fr-icon-account-circle-line",label:t(a)("Me"),to:"/me"},null,8,["label"])):n.organization?(d(),p(P,{key:1},[i(W,{iconHtml:t(ds),label:t(a)("Datasets"),to:{name:"organization-datasets",params:{oid:n.organization.id}},onClick:u[1]||(u[1]=f=>n.$emit("click"))},null,8,["iconHtml","label","to"]),i(W,{icon:"fr-icon-line-chart-line",label:t(a)("Reuses"),to:{name:"organization-reuses",params:{oid:n.organization.id}},onClick:u[2]||(u[2]=f=>n.$emit("click"))},null,8,["label","to"]),i(W,{icon:"fr-icon-parent-line",label:t(a)("Members"),to:{name:"organization-members",params:{oid:n.organization.id}}},null,8,["label","to"]),i(W,{icon:"fr-icon-user-line",label:t(a)("Profile"),to:{name:"organization-profile",params:{oid:n.organization.id}}},null,8,["label","to"])],64)):A("",!0)])],8,hs)],2))}});const le=H(vs,[["__scopeId","data-v-352caa70"]]),ys={class:"fr-container--fluid h-100"},$s={class:"fr-grid-row h-100 bg-grey-50"},ws={class:"fr-col-12 fr-col-md-4 fr-col-lg-3 fr-col-xl-2"},ks=["aria-label"],As={class:"fr-sidemenu__inner"},zs=["aria-controls"],Cs=["id"],Ms={class:"fr-sidemenu__list"},qs={class:"fr-col-12 fr-col-md-8 fr-col-lg-9 fr-col-xl-10 h-100 fr-px-2w"},Ss=M({__name:"Admin",setup(g){const{t:s}=T(),a=Re(),m=F("menu"),r=$(null),n=$(),{setCurrentOrganization:u}=x(),f=ue();function y(v){return v===n.value}function w(v){n.value=v.id}return V(async()=>{var v,c;if(r.value=await X(),a.name||(r.value.organizations.length>0?f.replace({name:"organization-datasets",params:{oid:r.value.organizations[0].id}}):f.replace({name:"me"})),a.name==="me")n.value=(v=E)==null?void 0:v.id;else if(r.value.organizations.length>0){let l=r.value.organizations[0];a.params.oid&&(l=(c=r.value.organizations.find(b=>b.id===a.params.oid))!=null?c:l),w(l),u(l)}}),(v,c)=>{const l=B("router-view");return d(),p("div",ys,[e("div",$s,[e("div",ws,[e("nav",{class:"fr-sidemenu fr-pr-0","aria-label":t(s)("Administration menu")},[e("div",As,[e("button",{class:"fr-sidemenu__btn",hidden:"","aria-controls":t(m),"aria-expanded":"false"},o(t(s)("Open menu")),9,zs),e("div",{class:"fr-collapse",id:t(m)},[e("ul",Ms,[t(E)?(d(),q(le,{key:0,user:t(E),"is-opened":y(t(E).id),onOpen:c[0]||(c[0]=b=>w(t(E)))},null,8,["user","is-opened"])):A("",!0),r.value?(d(!0),p(P,{key:1},J(r.value.organizations,b=>(d(),q(le,{organization:b,"is-opened":y(b.id),onOpen:()=>w(b),onClick:()=>t(u)(b)},null,8,["organization","is-opened","onOpen","onClick"]))),256)):A("",!0)])],8,Cs)])],8,ks)]),e("div",qs,[(d(),q(l,{key:t(a).fullPath,class:"fr-container--fluid"}))])])])}}});const Ts=H(Ss,[["__scopeId","data-v-1057ebbe"]]),Rs=["aria-labelledby","id"],Ps={class:"fr-container fr-container--fluid fr-container-md"},Is={class:"fr-grid-row fr-grid-row--center"},Os={class:"fr-col-12 fr-col-md-8"},Ds={class:"fr-modal__body"},Fs={class:"fr-modal__header"},Bs=["title","aria-controls"],Us={class:"fr-modal__content"},Ls=["id"],Es={class:"fr-modal__footer"},Vs={class:"fr-btns-group fr-btns-group--right fr-btns-group--sm fr-btns-group--inline-lg fr-btns-group--icon-left"},Hs=["disabled"],js=["disabled"],Ns=M({__name:"AdminAddMemberModal",props:{id:{},oid:{},roles:{}},emits:["memberAdded"],setup(g,{emit:s}){const a=g,m=s,{t:r}=T(),{toast:n}=G(),u=$(!1),f=$(),y=$("editor"),w=U(()=>"fr-modal-title-user-"+a.id);async function v(){try{u.value=!0,f.value&&(await Ie(a.oid,f.value,y.value),m("memberAdded"),l())}catch(b){n.error(r("An error occurred while update member role."))}finally{u.value=!1}}function c(b){return b.map(z=>{var C;const h={...z,avatar_thumbnail:(C=z.avatar_url)!=null?C:void 0};return{value:h.id,label:h.first_name+" "+h.last_name,image:Oe(h,32)}})}function l(){u.value=!1,f.value=void 0,y.value="editor";const b=document.getElementById(a.id);globalThis.dsfr(b).modal.conceal()}return(b,z)=>(d(),q(Q,{to:"body"},[e("dialog",{"aria-labelledby":w.value,role:"dialog",id:b.id,class:"fr-modal"},[e("div",Ps,[e("div",Is,[e("div",Os,[e("div",Ds,[e("div",Fs,[e("button",{class:"fr-btn--close fr-btn",title:t(r)("Close the modal dialog"),"aria-controls":b.id},o(t(r)("Close")),9,Bs)]),e("form",{onSubmit:K(v,["prevent"])},[e("div",Us,[e("h1",{id:w.value,class:"fr-modal__title fr-mb-2w"},o(t(r)("Add member to the organization")),9,Ls),i(Pe,{placeholder:b.$t("Search a user"),searchPlaceholder:b.$t("Search a user..."),suggestUrl:"/users/suggest/",values:f.value,onChange:z[0]||(z[0]=h=>f.value=h),allOption:b.$t("Select a user"),addAllOption:!1,onSuggest:c,roundedImages:!0},null,8,["placeholder","searchPlaceholder","values","allOption"]),b.roles.length>0?(d(),q(fe,{key:0,label:t(r)("Role of the member"),"model-value":y.value,"onUpdate:modelValue":z[1]||(z[1]=h=>y.value=h),options:b.roles},null,8,["label","model-value","options"])):A("",!0)]),e("div",Es,[e("div",Vs,[e("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary-grey-500",type:"button",onClick:l,disabled:u.value},o(t(r)("Cancel")),9,Hs),e("button",{class:"fr-btn",type:"submit",disabled:u.value},o(t(r)("Add to the organization")),9,js)])])],32)])])])])],8,Rs)]))}}),Ws=["aria-controls"],Ys=M({__name:"AdminAddMemberButton",props:{oid:{},roles:{}},emits:["memberAdded"],setup(g){const s=g,{t:a}=T(),m=U(()=>"fr-modal-add-user-"+s.oid);return(r,n)=>(d(),p(P,null,[e("button",{class:"fr-btn fr-btn--sm fr-btn--icon-left fr-icon-add-line","data-fr-opened":"false","aria-controls":m.value},o(t(a)("Add member")),9,Ws),i(Ns,{id:m.value,oid:r.oid,roles:r.roles,onMemberAdded:n[0]||(n[0]=u=>r.$emit("memberAdded"))},null,8,["id","oid","roles"])],64))}}),Zs={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle"},_e=M({__name:"AdminDangerZone",setup(g){return(s,a)=>(d(),q(t(De),{color:"error",type:"secondary",weight:"regular"},{default:_(()=>[e("div",Zs,[O(s.$slots,"default")])]),_:3}))}}),Js=["aria-labelledby","id"],Ks={class:"fr-container fr-container--fluid fr-container-md"},Qs={class:"fr-grid-row fr-grid-row--center"},Xs={class:"fr-col-12 fr-col-md-8"},Gs={class:"fr-modal__body"},xs={class:"fr-modal__header"},eo=["title","aria-controls"],to={class:"fr-modal__content"},so=["id"],oo={class:"fr-grid-row fr-grid-row--middle fr-text--bold fr-mb-2w"},ao={class:"fr-col"},ro={class:"fr-col-auto"},no=["disabled"],lo={class:"fr-col"},io={class:"fr-m-0 text-grey-500"},co={class:"fr-m-0 fr-text--xs text-default-error"},uo={class:"fr-col-auto"},fo=["disabled"],_o=M({__name:"AdminEditMemberModal",props:{id:{},member:{},oid:{},roles:{}},emits:["memberUpdated"],setup(g,{emit:s}){const a=g,m=s,r=U(()=>"fr-modal-title-user-"+a.id),{t:n}=T(),{toast:u}=G(),f=$(!1);async function y(l){if(!l.newRole){c();return}try{f.value=!0,await Fe(a.oid,l.user.id,l.newRole),m("memberUpdated"),c()}catch(b){u.error(n("An error occurred while update member role."))}finally{f.value=!1}}async function w(l){try{f.value=!0,await Be(a.oid,l.user.id),m("memberUpdated")}catch(b){u.error(n("An error occurred while removing this member."))}finally{f.value=!1}}function v(l){return a.roles.map(b=>{const z={...b};return z.value===l&&(z.selected=!0),z})}function c(){f.value=!1;const l=document.getElementById(a.id);globalThis.dsfr(l).modal.conceal()}return(l,b)=>(d(),q(Q,{to:"body"},[e("dialog",{"aria-labelledby":r.value,role:"dialog",id:l.id,class:"fr-modal"},[e("div",Ks,[e("div",Qs,[e("div",Xs,[e("div",Gs,[e("div",xs,[e("button",{class:"fr-btn--close fr-btn",title:t(n)("Close the modal dialog"),"aria-controls":l.id},o(t(n)("Close")),9,eo)]),e("div",to,[e("h1",{id:r.value,class:"fr-modal__title fr-mb-2w"},o(t(n)("Edit member")),9,so),e("p",oo,[i(ae,{class:"fr-mr-1v",user:l.member.user,rounded:!0,size:24},null,8,["user"]),k(" "+o(l.member.user.first_name)+" "+o(l.member.user.last_name),1)]),e("form",{class:"fr-grid-row fr-grid-row--gutters fr-grid-row--bottom",onSubmit:b[1]||(b[1]=K(z=>y(l.member),["prevent"]))},[e("div",ao,[l.roles.length>0?(d(),q(fe,{key:0,label:t(n)("Role of the member"),"model-value":l.member.role,"onUpdate:modelValue":b[0]||(b[0]=z=>l.member.newRole=z),options:v(l.member.role)},null,8,["label","model-value","options"])):A("",!0)]),e("div",ro,[e("button",{class:"fr-btn",type:"submit",disabled:f.value},o(t(n)("Validate")),9,no)])],32),i(_e,{class:"fr-mt-2w"},{default:_(()=>[e("div",lo,[e("p",io,o(t(n)("Remove member from the organization")),1),e("p",co,o(t(n)("Be careful, this action can't be reverse.")),1)]),e("div",uo,[e("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary--error fr-btn--icon-left fr-icon-logout-box-r-line",disabled:f.value,onClick:b[2]||(b[2]=z=>w(l.member))},o(t(n)("Remove member")),9,fo)])]),_:1})])])])])])],8,Js)]))}}),mo=["aria-controls"],po=M({__name:"AdminEditMemberButton",props:{member:{},oid:{},roles:{}},emits:["memberUpdated"],setup(g){const s=g,{t:a}=T(),m=U(()=>"fr-modal-user-"+s.member.user.id);return(r,n)=>(d(),p(P,null,[e("button",{class:"fr-btn fr-btn--sm fr-btn--tertiary-no-outline fr-icon-pencil-line","data-fr-opened":"false","aria-controls":m.value},o(t(a)("Edit")),9,mo),i(_o,{id:m.value,member:r.member,oid:r.oid,roles:r.roles,onMemberUpdated:n[0]||(n[0]=u=>r.$emit("memberUpdated"))},null,8,["id","member","oid","roles"])],64))}}),bo={class:"fr-mt-n9v fr-mb-2w"},ho={class:"fr-badge fr-badge--info fr-badge--no-icon"},go={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle"},vo={class:"fr-col"},yo={class:"fr-grid-row fr-grid-row--middle"},$o={class:"fr-ml-3v fr-mt-1-5v fr-mb-0 filet filet-default-grey fr-text--sm"},wo={key:0,class:"fr-col-auto fr-grid-row flex-direction-column"},ko=["disabled"],Ao=["disabled","aria-controls"],zo=["aria-labelledby","id"],Co={class:"fr-container fr-container--fluid fr-container-md"},Mo={class:"fr-grid-row fr-grid-row--center"},qo={class:"fr-col-12 fr-col-md-8"},So={class:"fr-modal__body"},To={class:"fr-modal__header"},Ro=["title","aria-controls"],Po={class:"fr-modal__content"},Io=["id"],Oo={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--right"},Do={class:"fr-col-auto"},Fo=["disabled"],Bo={class:"fr-col-auto"},Uo=["disabled"],Lo=M({__name:"AdminMembershipRequest",props:{loading:{type:Boolean},oid:{},request:{},showActions:{type:Boolean}},emits:["accept","refuse"],setup(g,{emit:s}){const a=g,m=s,{t:r}=T(),n=$(""),u=F("modal"),f=F("modalTitle");function y(){const c=document.getElementById(u);globalThis.dsfr(c).modal.conceal()}function w(){m("refuse",a.request.id,n.value),y()}function v(){n.value="",y()}return(c,l)=>{const b=B("AdminMembershipRequest",!0);return d(),q(oe,{class:"drop-shadow rounded-xxs fr-mt-3w"},{default:_(()=>[e("div",bo,[e("p",ho,[l[2]||(l[2]=e("span",{class:"fr-icon-user-add-line fr-icon--sm","aria-hidden":"true"},null,-1)),k(" "+o(t(r)("Membership Request")),1)])]),e("div",go,[e("div",vo,[e("div",yo,[i(ae,{class:"fr-mr-1v",user:c.request.user,rounded:!0,size:24},null,8,["user"]),k(" "+o(t(r)("{fullName} asks to join the organization.",{fullName:c.request.user.first_name+" "+c.request.user.last_name})),1)]),e("div",$o,o(c.request.comment),1)]),c.showActions?(d(),p("div",wo,[e("button",{class:"fr-btn fr-btn--sm fr-btn--icon-left fr-mb-1w fr-icon-check-line",onClick:l[0]||(l[0]=z=>c.$emit("accept",c.request.id)),disabled:c.loading,"data-testid":"accept"},o(t(r)("Accept request")),9,ko),e("button",{class:"fr-btn fr-btn--icon-left fr-btn--sm fr-btn--secondary fr-btn--secondary--error fr-icon-close-line",disabled:c.loading,"data-fr-opened":"false","aria-controls":t(u),"data-testid":"refuse"},o(t(r)("Refuse")),9,Ao),(d(),q(Q,{to:"body"},[e("dialog",{"aria-labelledby":t(f),role:"dialog",id:t(u),class:"fr-modal","data-testid":"modal"},[e("div",Co,[e("div",Mo,[e("div",qo,[e("div",So,[e("div",To,[e("button",{class:"fr-btn--close fr-btn",title:t(r)("Close the modal dialog"),"aria-controls":t(u),onClick:K(v,["prevent"])},o(t(r)("Close")),9,Ro)]),e("div",Po,[e("h1",{id:t(f),class:"fr-modal__title fr-mb-2w"},o(t(r)("Refuse membership request")),9,Io),i(b,{class:"fr-mt-4w fr-mb-2w",loading:!1,oid:c.oid,request:c.request,"show-actions":!1},null,8,["oid","request"]),e("form",{onSubmit:K(w,["prevent"]),onReset:v},[i(Ue,{label:t(r)("You can provide the refusal reason:"),modelValue:n.value,"onUpdate:modelValue":l[1]||(l[1]=z=>n.value=z),"data-testid":"comment-group"},null,8,["label","modelValue"]),e("div",Oo,[e("div",Do,[e("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary-grey-500",type:"reset",disabled:c.loading,"data-testid":"cancel-modal-button"},o(t(r)("Cancel")),9,Fo)]),e("div",Bo,[e("button",{class:"fr-btn",type:"submit",disabled:c.loading,"data-testid":"refuse-modal-button"},o(t(r)("Refuse request")),9,Uo)])])],32)])])])])])],8,zo)]))])):A("",!0)])]),_:1})}}}),Eo={key:0},Vo={class:"fr-breadcrumb__link","aria-current":"page"},Ho={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle justify-center"},jo={class:"fr-col-12 fr-col-md"},No={class:"fr-h1 fr-mb-2w"},Wo={key:0,class:"fr-col-auto"},Yo={class:"subtitle subtitle--uppercase"},Zo={class:"subtitle subtitle--uppercase fr-mt-2w fr-mb-1v"},Jo={class:"fr-table fr-table--layout-fixed"},Ko={scope:"col"},Qo={scope:"col"},Xo={scope:"col"},Go={scope:"col"},xo={scope:"col"},ea={key:0,scope:"col"},ta={class:"fr-badge"},sa={key:0},oa={key:1},aa={key:0},ra=M({__name:"Members",props:{oid:{}},setup(g){const s=g,{t:a}=T(),{toast:m}=G(),r=$([]),n=U(()=>Le||y.value.some(h=>{var C;return h.user.id===((C=E)==null?void 0:C.id)&&h.role==="admin"})),u=$([]),{currentOrganization:f}=x(),y=$([]),w=$(!1);function v(h){var C,R;return(R=(C=u.value.find(S=>S.value===h))==null?void 0:C.label)!=null?R:h}async function c(){const h=await je(s.oid);y.value=h.members}async function l(){const h=await re(s.oid);r.value=h}async function b(h){w.value=!0;const C=[];try{await Ne(s.oid,h),C.push(l()),C.push(c())}catch(R){m.error(a("An error occurred while accepting this membership."))}finally{Promise.all(C).finally(()=>w.value=!1)}}async function z(h,C){w.value=!0;const R=[];try{await We(s.oid,h,C),R.push(l()),R.push(c())}catch(S){m.error(a("An error occurred while refusing this membership."))}finally{Promise.all(R).finally(()=>w.value=!1)}}return se(()=>{n.value&&re(s.oid).then(h=>r.value=h)}),V(()=>{Ee().then(Ve).then(h=>u.value=h),c()}),(h,C)=>{const R=B("router-link");return d(),p("div",null,[i(Z,null,{default:_(()=>[e("li",null,[i(R,{class:"fr-breadcrumb__link",to:"/"},{default:_(()=>[k(o(t(a)("Administration")),1)]),_:1})]),t(f)?(d(),p("li",Eo,[i(R,{class:"fr-breadcrumb__link",to:"/"},{default:_(()=>[k(o(t(f).name),1)]),_:1})])):A("",!0),e("li",null,[e("a",Vo,o(t(a)("Members")),1)])]),_:1}),e("div",Ho,[e("div",jo,[e("h1",No,o(t(a)("Members")),1)]),n.value?(d(),p("div",Wo,[i(Ys,{oid:h.oid,roles:u.value,onMemberAdded:c},null,8,["oid","roles"])])):A("",!0)]),r.value.length?(d(),p(P,{key:0},[e("h2",Yo,o(t(a)("{n} requests",{n:r.value.length})),1),(d(!0),p(P,null,J(r.value,S=>(d(),q(Lo,{class:"fr-mb-4w",key:S.id,loading:w.value,oid:h.oid,request:S,"show-actions":!0,onAccept:b,onRefuse:z},null,8,["loading","oid","request"]))),128))],64)):A("",!0),e("h2",Zo,o(t(a)("{n} members",{n:y.value.length})),1),e("div",Jo,[e("table",null,[e("thead",null,[e("tr",null,[e("th",Ko,o(t(a)("Members")),1),e("th",Qo,o(t(a)("Email")),1),e("th",Xo,o(t(a)("Status")),1),e("th",Go,o(t(a)("Member since")),1),e("th",xo,o(t(a)("Last connection")),1),n.value?(d(),p("th",ea,o(t(a)("Action")),1)):A("",!0)])]),e("tbody",null,[(d(!0),p(P,null,J(y.value,S=>(d(),p("tr",{key:S.user.id},[e("td",null,o(S.user.first_name)+" "+o(S.user.last_name),1),e("td",null,o(S.user.email),1),e("td",null,[e("p",ta,o(v(S.role)),1)]),e("td",null,o(t(ee)(S.since)),1),e("td",null,[S.user.last_login_at?(d(),p("span",sa,o(t(He)(S.user.last_login_at)),1)):(d(),p("span",oa,o(t(a)("No connection")),1))]),n.value?(d(),p("td",aa,[i(po,{member:S,oid:h.oid,roles:u.value,onMemberUpdated:c},null,8,["member","oid","roles"])])):A("",!0)]))),128))])])])])}}}),na={class:"fr-container--fluid"},la={key:0},ia={class:"fr-breadcrumb__link","aria-current":"page"},da=["id"],ca=["disabled","onClick"],ua={class:"fr-col"},fa={class:"fr-m-0 text-grey-500"},_a={class:"fr-m-0 fr-text--xs text-default-error"},ma={class:"fr-col-auto"},pa=["disabled","aria-controls"],ba=["aria-labelledby","id"],ha={class:"fr-container fr-container--fluid fr-container-md"},ga={class:"fr-grid-row fr-grid-row--center"},va={class:"fr-col-12 fr-col-md-8"},ya={class:"fr-modal__body"},$a={class:"fr-modal__header"},wa=["title","aria-controls"],ka={class:"fr-modal__content"},Aa=["id"],za={class:"fr-text--bold"},Ca={class:"fr-modal__footer"},Ma={class:"fr-btns-group fr-btns-group--right fr-btns-group--inline-reverse fr-btns-group--inline-lg fr-btns-group--icon-left"},qa=["disabled"],Sa=M({__name:"Profile",props:{oid:{}},setup(g){const{t:s}=T(),{toast:a}=G(),m=ue(),r=$(null),n=$(null),{currentOrganization:u}=x(),f=$([]),y=$(!1),w=F("modal"),v=F("modalTitle");function c(){u.value&&(y.value=!0,Ze(u.value.id).then(()=>{m.replace("/"),window.location.reload()}).catch(()=>a.error(s("An error occured when deleting the organization."))).finally(()=>y.value=!1))}function l(b){y.value=!0,Je(b).then(()=>a.success(s("Organization updated !"))).catch(()=>a.error(s("An error occured when updating the organization."))).finally(()=>y.value=!1)}return V(async()=>r.value=await X()),(b,z)=>{const h=B("router-link");return d(),p("div",na,[i(Z,null,{default:_(()=>[e("li",null,[i(h,{class:"fr-breadcrumb__link",to:"/"},{default:_(()=>[k(o(t(s)("Administration")),1)]),_:1})]),t(u)?(d(),p("li",la,[i(h,{class:"fr-breadcrumb__link",to:"/"},{default:_(()=>[k(o(t(u).name),1)]),_:1})])):A("",!0),e("li",null,[e("a",ia,o(t(s)("Profile")),1)])]),_:1}),n.value?(d(),p("h2",{key:0,class:"subtitle subtitle--uppercase fr-mb-5v",id:n.value.legend},o(t(s)("Edit profile")),9,da)):A("",!0),t(u)?(d(),q(Ye,{key:1,organization:t(u),errors:f.value,showLegend:!1,showWell:!1,ref_key:"form",ref:n,onSubmit:l},{submitButton:_(({submit:C})=>[e("button",{class:"fr-btn fr-btn--icon-left fr-icon-save-line",disabled:y.value,"data-testid":"submitButton",onClick:C},o(t(s)("Save")),9,ca)]),default:_(()=>[i(_e,{class:"fr-mt-6w"},{default:_(()=>[e("div",ua,[e("p",fa,o(t(s)("Delete the organization")),1),e("p",_a,o(t(s)("Be careful, this action can't be reverse.")),1)]),e("div",ma,[e("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary--error fr-btn--icon-left fr-icon-delete-line",disabled:y.value,"data-fr-opened":"false","aria-controls":t(w)},o(t(s)("Delete")),9,pa),(d(),q(Q,{to:"body"},[e("dialog",{"aria-labelledby":t(v),role:"dialog",id:t(w),class:"fr-modal"},[e("div",ha,[e("div",ga,[e("div",va,[e("div",ya,[e("div",$a,[e("button",{class:"fr-btn--close fr-btn",title:t(s)("Close the modal dialog"),"aria-controls":t(w)},o(t(s)("Close")),9,wa)]),e("div",ka,[e("h1",{id:t(v),class:"fr-modal__title fr-mb-2w"},o(t(s)("Are you sure you want to delete this organization ?")),9,Aa),e("p",za,o(t(s)("This action can't be reverse.")),1),e("p",null,o(t(s)("All content published with this organization will stay online, with the same URL but in an anonymous form, i.e. without being linked to a data producer.")),1),e("p",null,o(t(s)("If you want to delete your published content too, start by deleting the contents before deleting your account.")),1)]),e("div",Ca,[e("div",Ma,[e("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary--error",role:"button",disabled:y.value,onClick:c},o(t(s)("Delete")),9,qa)])])])])])])],8,ba)]))])]),_:1})]),_:1},8,["organization","errors"])):A("",!0)])}}});Ke({admin_root:de,default_lang:te.global.locale.value,only_locales:te.global.locale.value,schema_documentation_url:Qe,schema_validata_url:Xe,show_copy_resource_permalink:!0,tabular_api_url:Ge,tabular_page_size:xe,title:ce});const Ta=[{path:"/me",component:is,name:"me"},{path:"/organizations/:oid",children:[{path:"datasets",component:Qt,props:!0,name:"organization-datasets"},{path:"reuses",component:ss,props:!0,name:"organization-reuses"},{path:"members",component:ra,props:!0,name:"organization-members"},{path:"profile",component:Sa,props:!0,name:"organization-profile"}]}],Ra=et({history:tt(),routes:Ta}),j=be(Ts);st(j);j.use(ot);j.use(at);j.use(te);j.use(Ra);j.mount("#admin");globalThis.dsfr.start();console.log("JS is injected !");export{Pa as __vite_legacy_guard};
