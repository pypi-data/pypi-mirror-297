import{_ as C}from"./index.48451be9.js";import{ai as i,o as b,c as $,U as a,O as n,a as g,S as v,T as m,M as k,R as z,aq as O,a9 as R,P as T}from"./vendor-vue.6656f86d.js";import{c as P}from"./vendor-lib.0c69f4b8.js";import"./element-plus.4c52821c.js";import"./element-icon.5ea24094.js";const F={username:[{message:"\u7528\u6237\u540D\u4E0D\u80FD\u4E3A\u7A7A",required:!0,trigger:"blur"}],password:[{message:"\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A",required:!0,trigger:"blur"}],avatar_url:[{message:"\u5934\u50CF\u4E0D\u80FD\u4E3A\u7A7A",required:!0,trigger:"blur"}],before_expire_days:[{message:"\u8FC7\u671F\u524D\u591A\u5C11\u5929\u63D0\u9192\u4E0D\u80FD\u4E3A\u7A7A",required:!0,trigger:"blur"}],email_list:[{message:"\u90AE\u4EF6\u5217\u8868\u4E0D\u80FD\u4E3A\u7A7A",required:!0,trigger:"blur"}]},q={name:"",props:{row:{type:Object,default:null}},components:{},data(){return{rules:F,form:{username:"",password:"",avatar_url:"",before_expire_days:"",email_list:""}}},computed:{},methods:{async getData(){if(this.row){let t={id:this.row.id};const l=await this.$http.function(t);if(l.code!=0)return;let d=l.data;this.form.username=d.username,this.form.avatar_url=d.avatar_url,this.form.before_expire_days=d.before_expire_days,this.form.email_list=d.email_list}},handleCancel(){this.$emit("on-cancel")},handleSubmit(){this.$refs.form.validate(t=>{if(t)this.confirmSubmit();else return!1})},async confirmSubmit(){let t=this.$loading({fullscreen:!0}),l={username:this.form.username.trim(),password:this.form.password.trim()};this.row&&(l.id=this.row.id);const d=await this.$http.addUser(l);d.code==0?(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success")):this.$msg.error(d.msg),this.$nextTick(()=>{t.close()})}},created(){this.getData()}},x={class:"text-center"};function B(t,l,d,w,r,o){const u=i("el-input"),c=i("el-form-item"),p=i("el-form"),_=i("el-button");return b(),$("div",null,[a(p,{ref:"form",model:r.form,rules:r.rules,"label-width":"100px"},{default:n(()=>[a(c,{label:t.$t("\u7528\u6237\u540D"),prop:"username"},{default:n(()=>[a(u,{type:"text",modelValue:r.form.username,"onUpdate:modelValue":l[0]||(l[0]=h=>r.form.username=h),placeholder:t.$t("\u8BF7\u8F93\u5165\u7528\u6237\u540D")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(c,{label:t.$t("\u5BC6\u7801"),prop:"password"},{default:n(()=>[a(u,{type:"text",modelValue:r.form.password,"onUpdate:modelValue":l[1]||(l[1]=h=>r.form.password=h),placeholder:t.$t("\u8BF7\u8F93\u5165\u5BC6\u7801")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model","rules"]),g("div",x,[a(_,{onClick:o.handleCancel},{default:n(()=>[v(m(t.$t("\u53D6\u6D88")),1)]),_:1},8,["onClick"]),a(_,{type:"primary",onClick:o.handleSubmit},{default:n(()=>[v(m(t.$t("\u786E\u5B9A")),1)]),_:1},8,["onClick"])])])}const A=C(q,[["render",B]]),j={name:"",props:{row:{type:Object,default:null},visible:{type:Boolean,default:!1}},emits:["update:visible"],components:{DataForm:A},data(){return{}},computed:{dialogTitle(){return this.row?this.$t("\u7F16\u8F91\u7528\u6237"):this.$t("\u6DFB\u52A0\u7528\u6237")},dialogVisible:{get(){return this.visible},set(t){this.$emit("update:visible",t)}}},methods:{handleClose(){this.$emit("update:visible",!1)},handleOpen(){this.$emit("update:visible",!0)},handleSuccess(){this.handleClose(),this.$emit("on-success")}},created(){}};function N(t,l,d,w,r,o){const u=i("DataForm"),c=i("el-dialog");return b(),k(c,{title:o.dialogTitle,modelValue:o.dialogVisible,"onUpdate:modelValue":l[0]||(l[0]=p=>o.dialogVisible=p),width:"400px",center:"","append-to-body":"","lock-scroll":!1},{default:n(()=>[o.dialogVisible?(b(),k(u,{key:0,row:d.row,onOnCancel:o.handleClose,onOnSuccess:o.handleSuccess},null,8,["row","onOnCancel","onOnSuccess"])):z("",!0)]),_:1},8,["title","modelValue"])}const U=C(j,[["render",N]]),I={name:"",components:{DataFormDailog:U},props:{list:{type:Array}},computed:{},data(){return{currentRow:null,dialogVisible:!1}},methods:{handleEditRow(t){this.currentRow=t,this.dialogVisible=!0},async handleDeleteClick(t){let l={user_id:t.id};(await this.$http.deleteUser(l)).code==0&&(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success"))},async handleResetUserPasswordUser(t){let l={user_id:t.id};const d=await this.$http.resetUserPasswordUser(l);d.ok&&this.$alert(`\u65B0\u5BC6\u7801\uFF1A${d.data.password}`,"\u5BC6\u7801\u91CD\u7F6E\u6210\u529F",{center:!0,autofocus:!1,confirmButtonText:"\u590D\u5236",type:"success"}).then(()=>{P(d.data.password),this.$msg.success("\u5DF2\u590D\u5236\u5230\u526A\u5207\u677F")}).catch(()=>{})},async handleStatusChange(t,l){let d={user_id:t.id,status:l};(await this.$http.updateUserStatus(d)).code==0&&this.$msg.success("\u64CD\u4F5C\u6210\u529F")},handleUpdateSuccess(){this.$emit("on-success")}},created(){}};function K(t,l,d,w,r,o){const u=i("el-table-column"),c=i("el-switch"),p=i("Refresh"),_=i("el-icon"),h=i("el-link"),y=i("el-popconfirm"),S=i("Delete"),D=i("el-table"),V=i("DataFormDailog");return b(),$("div",null,[a(D,{data:d.list,stripe:"",border:""},{default:n(()=>[a(u,{label:t.$t("\u5E8F\u53F7"),align:"center",prop:"id",width:"60"},{default:n(s=>[g("span",null,m(s.$index+1),1)]),_:1},8,["label"]),a(u,{label:t.$t("\u7528\u6237\u540D"),"header-align":"center",align:"center",prop:"username"},{default:n(s=>[g("span",null,m(s.row.username||"-"),1)]),_:1},8,["label"]),a(u,{label:t.$t("\u8BC1\u4E66\u6570\u91CF"),"header-align":"center",align:"center",prop:"cert_count",width:"100"},{default:n(s=>[g("span",null,m(s.row.cert_count||"-"),1)]),_:1},8,["label"]),a(u,{label:t.$t("\u57DF\u540D\u6570\u91CF"),"header-align":"center",align:"center",prop:"notify_count",width:"120"},{default:n(s=>[g("span",null,m(s.row.domain_count||"-"),1)]),_:1},8,["label"]),a(u,{label:t.$t("\u5206\u7EC4\u6570\u91CF"),"header-align":"center",align:"center",prop:"group_count",width:"110"},{default:n(s=>[g("span",null,m(s.row.group_count||"-"),1)]),_:1},8,["label"]),a(u,{label:t.$t("\u901A\u77E5\u6E20\u9053"),"header-align":"center",align:"center",prop:"notify_count",width:"100"},{default:n(s=>[g("span",null,m(s.row.notify_count||"-"),1)]),_:1},8,["label"]),a(u,{label:t.$t("\u542F\u7528"),"header-align":"center",align:"center",width:"80"},{default:n(s=>[a(c,{disabled:s.row.username=="admin",modelValue:s.row.status,"onUpdate:modelValue":f=>s.row.status=f,onChange:f=>o.handleStatusChange(s.row,f)},null,8,["disabled","modelValue","onUpdate:modelValue","onChange"])]),_:1},8,["label"]),a(u,{label:t.$t("\u91CD\u7F6E\u5BC6\u7801"),width:"150",align:"center",prop:"tag"},{default:n(s=>[a(y,{title:"\u786E\u5B9A\u91CD\u7F6E\u5BC6\u7801\uFF1F",onConfirm:f=>o.handleResetUserPasswordUser(s.row),disabled:s.row.username=="admin"},{reference:n(()=>[a(h,{disabled:s.row.username=="admin",underline:!1,type:"primary"},{default:n(()=>[a(_,null,{default:n(()=>[a(p)]),_:1})]),_:2},1032,["disabled"])]),_:2},1032,["onConfirm","disabled"])]),_:1},8,["label"]),a(u,{label:t.$t("\u5220\u9664"),width:"60",align:"center",prop:"tag"},{default:n(s=>[a(y,{title:`${t.$t("\u786E\u5B9A\u5220\u9664")}\uFF1F`,onConfirm:f=>o.handleDeleteClick(s.row),disabled:s.row.username=="admin"},{reference:n(()=>[a(h,{disabled:s.row.username=="admin",underline:!1,type:"danger"},{default:n(()=>[a(_,null,{default:n(()=>[a(S)]),_:1})]),_:2},1032,["disabled"])]),_:2},1032,["title","onConfirm","disabled"])]),_:1},8,["label"])]),_:1},8,["data"]),a(V,{visible:r.dialogVisible,"onUpdate:visible":l[0]||(l[0]=s=>r.dialogVisible=s),row:r.currentRow,onOnSuccess:o.handleUpdateSuccess},null,8,["visible","row","onOnSuccess"])])}const E=C(I,[["render",K]]),L={name:"user-admin-list",props:{},components:{DataFormDailog:U,DataTable:E},data(){return{list:[],total:0,page:1,size:20,keyword:"",pageSizeCachekey:"pageSize",loading:!0,dialogVisible:!1}},computed:{},methods:{resetData(){this.page=1,this.getData()},refreshData(){this.getData()},async getData(){this.loading=!0;let t={page:this.page,size:this.size,keyword:this.keyword.trim()};const l=await this.$http.getUserList(t);l.code==0?(this.list=l.data.list,this.total=l.data.total):this.$msg.error(e.msg),this.loading=!1},handleAddRow(){this.dialogVisible=!0},handleAddSuccess(){this.resetData()},handleSearch(){this.resetData()},handleSizeChange(t){localStorage.setItem(this.pageSizeCachekey,t),this.resetData()},loadPageSize(){let t=localStorage.getItem(this.pageSizeCachekey);t&&(this.size=parseInt(t))}},created(){this.loadPageSize(),this.getData()}},M={class:"app-container"},G={class:"flex justify-between margin-bottom--20"};function H(t,l,d,w,r,o){const u=i("Plus"),c=i("el-icon"),p=i("el-button"),_=i("Search"),h=i("el-input"),y=i("DataTable"),S=i("el-pagination"),D=i("DataFormDailog"),V=O("loading");return b(),$("div",M,[g("div",G,[a(p,{type:"primary",onClick:o.handleAddRow},{default:n(()=>[a(c,null,{default:n(()=>[a(u)]),_:1}),v(m(t.$t("\u6DFB\u52A0")),1)]),_:1},8,["onClick"]),a(h,{class:"ml-sm",style:{width:"260px"},modelValue:r.keyword,"onUpdate:modelValue":l[0]||(l[0]=s=>r.keyword=s),placeholder:t.$t("\u641C\u7D22\u7528\u6237\u540D"),clearable:"",onKeypress:R(o.handleSearch,["enter"]),onClear:o.handleSearch},{append:n(()=>[a(p,{onClick:o.handleSearch},{default:n(()=>[a(c,null,{default:n(()=>[a(_)]),_:1})]),_:1},8,["onClick"])]),_:1},8,["modelValue","placeholder","onKeypress","onClear"])]),T(a(y,{class:"mt-md",list:r.list,onOnSuccess:o.resetData},null,8,["list","onOnSuccess"]),[[V,r.loading]]),a(S,{class:"mt-md justify-center",background:"",layout:"total, sizes, prev, pager, next",total:r.total,"page-size":r.size,"onUpdate:pageSize":l[1]||(l[1]=s=>r.size=s),"current-page":r.page,"onUpdate:currentPage":l[2]||(l[2]=s=>r.page=s),onCurrentChange:o.getData,onSizeChange:o.handleSizeChange},null,8,["total","page-size","current-page","onCurrentChange","onSizeChange"]),a(D,{visible:r.dialogVisible,"onUpdate:visible":l[3]||(l[3]=s=>r.dialogVisible=s),onOnSuccess:o.handleAddSuccess},null,8,["visible","onOnSuccess"])])}const Z=C(L,[["render",H]]);export{Z as default};
