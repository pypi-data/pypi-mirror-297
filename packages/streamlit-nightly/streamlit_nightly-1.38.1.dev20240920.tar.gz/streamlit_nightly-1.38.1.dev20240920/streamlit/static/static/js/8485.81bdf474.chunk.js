(self.webpackChunk_streamlit_app=self.webpackChunk_streamlit_app||[]).push([[8485],{57666:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>H});var o=i(58878),s=i(6334),n=i(72192),a=i(59353),r=i(78025),h=i(43338),l=i(8151),c=i(58144),d=i(85850),p=i(22044),m=i(53124),u=i.n(m),g=i(32782),x=i(67253),w=i(29669),b=i(1780),k=i(84152),S=i(6240),j=i(90782);const f=e=>{let{error:t,width:i,deltaType:o}=e;return t instanceof y?(0,j.jsx)(S.A,{width:i,name:"No Mapbox token provided",message:(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)("p",{children:["To use ",(0,j.jsxs)("code",{children:["st.",o]})," or ",(0,j.jsx)("code",{children:"st.map"})," you need to set up a Mapbox access token."]}),(0,j.jsxs)("p",{children:["To get a token, create an account at"," ",(0,j.jsx)("a",{href:"https://mapbox.com",children:"https://mapbox.com"}),". It's free for moderate usage levels!"]}),(0,j.jsxs)("p",{children:["Once you have a token, just set it using the Streamlit config option ",(0,j.jsx)("code",{children:"mapbox.token"})," and don't forget to restart your Streamlit server at this point if it's still running, then reload this tab."]}),(0,j.jsxs)("p",{children:["See"," ",(0,j.jsx)("a",{href:"https://docs.streamlit.io/develop/api-reference/configuration/config.toml",children:"our documentation"})," ","for more info on how to set config options."]})]})}):t instanceof v?(0,j.jsx)(S.A,{width:i,name:"Error fetching Streamlit Mapbox token",message:(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("p",{children:"This app requires an internet connection."}),(0,j.jsx)("p",{children:"Please check your connection and try again."}),(0,j.jsxs)("p",{children:["If you think this is a bug, please file bug report"," ",(0,j.jsx)("a",{href:"https://github.com/streamlit/streamlit/issues/new/choose",children:"here"}),"."]})]})}):(0,j.jsx)(S.A,{width:i,name:"Error fetching Streamlit Mapbox token",message:t.message})};class y extends Error{}class v extends Error{}const T="https://data.streamlit.io/tokens.json",C="mapbox",A=e=>t=>{class i extends o.PureComponent{constructor(i){super(i),this.context=void 0,this.initMapboxToken=async()=>{try{const e=await g.A.get(T),{[C]:t}=e.data;if(!t)throw new Error(`Missing token ${C}`);this.setState({mapboxToken:t,isFetching:!1})}catch(e){const t=(0,x.$)(e);throw this.setState({mapboxTokenError:t,isFetching:!1}),new v(`${t.message} (${T})`)}},this.render=()=>{const{mapboxToken:i,mapboxTokenError:o,isFetching:s}=this.state,{width:n}=this.props;return o?(0,j.jsx)(f,{width:n,error:o,deltaType:e}):s?(0,j.jsx)(b.E,{element:w.EA.create({style:w.EA.SkeletonStyle.ELEMENT})}):(0,j.jsx)(t,{...this.props,mapboxToken:i,width:n})},this.state={isFetching:!0,mapboxToken:void 0,mapboxTokenError:void 0}}componentDidMount(){const e=this.props.element.mapboxToken||this.context.libConfig.mapboxToken;e?this.setState({mapboxToken:e,isFetching:!1}):this.initMapboxToken()}}return i.displayName=`withMapboxToken(${t.displayName||t.name})`,i.contextType=k.n,u()(i,t)};var E=i(89653);const F=(0,E.A)("div",{target:"e1az0zs51"})((e=>{let{width:t,height:i}=e;return{position:"relative",height:i,width:t}}),""),M=(0,E.A)("div",{target:"e1az0zs50"})((e=>{let{theme:t}=e;return{position:"absolute",right:"2.625rem",top:t.spacing.md,zIndex:1,"button:not(:disabled)":{background:t.colors.bgColor,"& + button":{borderTopColor:t.colors.secondaryBg},"& span":{filter:(0,c.iq)(t)?"":"invert(100%)"}}}}),"");var V=i(21640),z=i(14251),O=i(86202),P=i(26592),$=i(64639),N=i(73417),_=i(27126),B=i(92502),D=i(19720),L=i(14249),q=i(71034),G=i.n(q);const I={classes:{...N,...D,...B,...L,CartoLayer:z.A},functions:{colorBins:O.A,colorCategories:P.A,colorContinuous:$.A}},J=new _.A({configuration:I}),W=(e,t)=>{const i=t.match(/{(.*?)}/g);return i&&i.forEach((i=>{const o=i.substring(1,i.length-1);e.object.hasOwnProperty(o)?t=t.replace(i,e.object[o]):e.object.hasOwnProperty("properties")&&e.object.properties.hasOwnProperty(o)&&(t=t.replace(i,e.object.properties[o]))})),t},U=e=>{var t;const{element:i,height:s,isFullScreen:n,isLightTheme:a,width:r}=e,{tooltip:h,useContainerWidth:l}=i,c=null!==n&&void 0!==n&&n,[d,p]=(0,o.useState)({bearing:0,pitch:0,zoom:11}),{height:m,width:u}=(e=>{let{container:t,element:i,heightFallback:s="auto",isFullScreen:n,shouldUseContainerWidth:a,widthFallback:r="auto"}=e;return{width:(0,o.useMemo)((()=>a||n?"100%":i.width||t.width||r),[t.width,i.width,n,a,r]),height:(0,o.useMemo)((()=>n&&t.height?t.height:i.height||t.height||s),[n,i.height,t.height,s])}})({element:i,isFullScreen:c,shouldUseContainerWidth:l,container:{height:s,width:r},heightFallback:(null===(t=d.initialViewState)||void 0===t?void 0:t.height)||500}),[g,x]=(0,o.useState)({}),w=(0,o.useMemo)((()=>Object.freeze(V.A.parse(i.json))),[c,a,i.json]),b=(0,o.useMemo)((()=>{const e={...w};return e.mapStyle||(e.mapStyle=`mapbox://styles/mapbox/${a?"light":"dark"}-v9`),c?Object.assign(e.initialViewState,{width:u,height:m}):(e.initialViewState.height||(e.initialViewState.height=500),l&&(e.initialViewState.width=u)),null===e||void 0===e||delete e.views,J.convert(e)}),[m,c,a,w,l,u]);(0,o.useEffect)((()=>{if(!G()(b.initialViewState,g)){const e=Object.keys(b.initialViewState).reduce(((e,t)=>b.initialViewState[t]===g[t]?e:{...e,[t]:b.initialViewState[t]}),{});p({...d,...e}),x(b.initialViewState)}}),[b.initialViewState,g,d]);const k=(0,o.useCallback)((e=>{if(!e||!e.object||!h)return null;const t=V.A.parse(h);return t.html?t.html=W(e,t.html):t.text=W(e,t.text),t}),[h]),S=(0,o.useCallback)((e=>{let{viewState:t}=e;p(t)}),[p]);return{createTooltip:k,deck:b,height:m,onViewStateChange:S,viewState:d,width:u}};i(93298);(0,h.mk)([a.y,r.B]);const Z=[],H=A("st.pydeck_chart")((0,p.A)((e=>{const{collapse:t,disableFullscreenMode:i,element:a,expand:r,height:h,isFullScreen:p,width:m}=e,u=(0,l.u)(),{createTooltip:g,deck:x,onViewStateChange:w,viewState:b,width:k,height:S}=U({element:a,isLightTheme:(0,c.iq)(u),width:m,height:h,isFullScreen:p}),[f,y]=(0,o.useState)(!1);return(0,o.useEffect)((()=>{y(!0)}),[]),(0,j.jsxs)(F,{className:"stDeckGlJsonChart","data-testid":"stDeckGlJsonChart",width:k,height:S,children:[(0,j.jsx)(d.A,{isFullScreen:p,disableFullscreenMode:i,onExpand:r,onCollapse:t,target:F}),(0,j.jsxs)(s.A,{viewState:b,onViewStateChange:w,height:S,width:k,layers:f?x.layers:Z,getTooltip:g,ContextProvider:n.wZ.Provider,controller:!0,children:[(0,j.jsx)(n.b,{height:S,width:k,mapStyle:x.mapStyle&&("string"===typeof x.mapStyle?x.mapStyle:x.mapStyle[0]),mapboxApiAccessToken:e.element.mapboxToken||e.mapboxToken}),(0,j.jsx)(M,{children:(0,j.jsx)(n.ov,{"data-testid":"stDeckGlJsonChartZoomButton",showCompass:!1})})]})]})}),!0))},63872:()=>{},35111:()=>{}}]);