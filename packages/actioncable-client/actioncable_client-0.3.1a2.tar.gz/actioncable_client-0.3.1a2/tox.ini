[tox]
min_version = 4.0
env_list =
    py312
    py311
    py310
    py39
    type
    report

[tool:pytest]
testpaths = tests

[testenv]
setenv =
    py{312,311,310,39}: COVERAGE_FILE = .coverage.{envname}
    py{312,311,310,39}: JUNIT_FILE = .report.{envname}.xml
deps = -r requirements_test.txt
commands = pytest --cov actioncable_client --junitxml=$JUNIT_FILE --cov-report=
depends =
    report: py312,py311,py310,py39

[testenv:type]
deps =
    -r requirements_test.txt
    mypy
    types-requests
commands = mypy src

[testenv:report]
skip_install = true
deps =
    -r requirements_test.txt
    coverage
    junitparser
commands =
    coverage combine
    coverage xml
    coverage report --fail-under=10
    coverage lcov -o lcov.info
    junitparser merge .report.py312.xml .report.py311.xml .report.py310.xml .report.py39.xml report.xml
